(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[838],{44994:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/earn/staking",function(){return n(87984)}])},87984:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return J}});var i=n(85893),a=n(19521),s=n(67294),r=n(9008),o=n.n(r),l=n(33358),c=n(8395);let{post:d}=c.messages;class m{async getCCNNodes(){var e,t,n,i;let a=await fetch("https://api2.aleph.im/api/v0/aggregates/0xa1B3bb7d2332383D96b7796B908fB7f7F3c2Be10.json?keys=corechannel&limit=100"),s=await a.json(),r=null==s?void 0:null===(e=s.data)||void 0===e?void 0:null===(t=e.corechannel)||void 0===t?void 0:t.resource_nodes,o=null==s?void 0:null===(n=s.data)||void 0===n?void 0:null===(i=n.corechannel)||void 0===i?void 0:i.nodes,l=await this.getScores(),c=new Map(l.map(e=>[e.node_id,e]));o=o.map(e=>{let t=c.get(e.hash);return t?{...e,score:t.total_score,scoreData:t}:e});let d=r.reduce((e,t)=>{let n=e[t.parent]=e[t.parent]||[];return n.push(t),e},{});return console.log(o=o.map(e=>{let t=d[e.hash]||[];return t?{...e,crnsData:t}:e})),o}async getScores(){var e,t,n;let i=await d.Get({types:"aleph-scoring-scores",addresses:[l.id],pagination:1,page:1});return console.log(i),null===(e=null===(t=i.posts[0])||void 0===t?void 0:t.content)||void 0===e?void 0:null===(n=e.scores)||void 0===n?void 0:n.ccn}async getMetrics(){return d.Get({types:"aleph-network-metrics",addresses:[l.id],pagination:1,page:1})}constructor(e,t=l.Nr){this.account=e,this.channel=t}}var p=n(3837);let u=(0,a.ZP)(p.iA).withConfig({displayName:"styles__StyledTable",componentId:"sc-gp6li6-0"})(["thead th{font-size:0.8125rem;}td,th{padding:0.75rem 1rem;width:0;}tr,td{border:none;}"]);var h=n(25675),g=n.n(h);let v=(0,s.memo)(e=>{let{hash:t,name:n,picture:a,locked:s}=e;return(0,i.jsxs)(f,{children:[a?(0,i.jsx)(y,{src:"".concat(l.pf,"/api/v0/storage/raw/").concat(a),alt:"Node profile image",width:24,height:24}):(0,i.jsx)(_,{name:"circle-nodes",size:"xl"}),(0,i.jsxs)(x,{className:"fs-xs",children:[(0,i.jsxs)("div",{children:["CCN-ID ",t.slice(-10)]}),(0,i.jsxs)(N,{children:[s&&(0,i.jsx)(p.u,{my:"top-center",at:"bottom-center",content:"No staker can join this node.",header:"Staking locked",children:(0,i.jsx)(p.JO,{name:"lock",size:"xs"})}),n.substring(0,30)]})]})]})});v.displayName="NameCell";var f=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-vt9uzz-0"})({display:"flex",alignItems:"center",gap:"0.75rem"}),y=(0,a.ZP)(g()).withConfig({displayName:"cmp___StyledImage",componentId:"sc-vt9uzz-1"})({height:"1.5rem",width:"1.5rem",borderRadius:"9999px"}),_=(0,a.ZP)(p.JO).withConfig({displayName:"cmp___StyledIcon",componentId:"sc-vt9uzz-2"})({borderRadius:"9999px"}),x=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv2",componentId:"sc-vt9uzz-3"})({lineHeight:"1rem"}),N=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv3",componentId:"sc-vt9uzz-4"})({display:"flex",alignItems:"center",gap:"0.25rem"});let w=a.ZP.div.withConfig({displayName:"styles__StyledLinkIcon",componentId:"sc-8oaxhu-0"})(e=>{let{theme:t,$active:n}=e,i=n?t.color.main1:"".concat(t.color.base0,"20");return[{height:"0.75rem",width:"0.5rem"},(0,a.iv)(["background-color:",";"],i)]}),j=(0,s.memo)(e=>{let{nodes:t,max:n=3}=e;return(0,i.jsxs)(C,{children:[(0,i.jsx)(S,{children:Array.from({length:n}).map((e,n)=>(0,i.jsx)(w,{$active:!!t[n]},n))}),(0,i.jsxs)(b,{className:"fs-xs",children:[t.length," ",(0,i.jsxs)(k,{children:["of ",n]})]})]})});j.displayName="LinkedCell";var C=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-s5fbn9-0"})({display:"flex",alignItems:"center",gap:"0.75rem"}),S=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv2",componentId:"sc-s5fbn9-1"})({display:"flex",alignItems:"stretch",gap:"0.125rem"}),b=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv3",componentId:"sc-s5fbn9-2"})({whiteSpace:"nowrap",lineHeight:"1rem"}),k=(0,a.ZP)("span").withConfig({displayName:"cmp___StyledSpan",componentId:"sc-s5fbn9-3"})({opacity:"0.2"});let I=a.ZP.div.withConfig({displayName:"styles__StyledScoreIcon",componentId:"sc-347ktn-0"})(e=>{let{theme:t,$score:n}=e,i=n>=.8?t.color.main1:n>=.5?t.color.main0:t.color.error;return[{height:"1rem",width:"1rem",borderRadius:"9999px"},(0,a.iv)(["background-color:",";"],i)]}),P=(0,s.memo)(e=>{let{score:t}=e,n=Number(100*t).toFixed(2);return(0,i.jsxs)(D,{children:[(0,i.jsx)(I,{$score:t}),n,"%"]})});P.displayName="ScoreCell";var D=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-gpthn5-0"})({display:"flex",alignItems:"center",gap:"0.75rem"});let Z=a.ZP.div.withConfig({displayName:"styles__StyledAPYIcon",componentId:"sc-1z11sih-0"})(e=>{let{theme:t,$performance:n}=e,i=n>=.8?t.color.main1:n>=.5?t.color.main0:t.color.error;return[{height:"1rem",width:"1rem",borderRadius:"9999px"},(0,a.iv)(["background-color:",";"],i)]});var A=n(34853);class z{activeNodes(e){return e.filter(e=>"active"===e.status)}totalStakedInActive(e){return this.activeNodes(e).reduce((e,t)=>e+t.total_staked,0)}totalPerDay(e){let t=this.activeNodes(e).length;return 15e3*((Math.log10(t)+1)/3)}totalPerAlephPerDay(e){return this.totalPerDay(e)/this.totalStakedInActive(e)}currentAPY(e){return(1+this.totalPerAlephPerDay(e))**365-1}computeEstimatedStakersAPY(e,t){let n=0;if(e.score){let i=Math.min(e.crnsData.filter(e=>e.score>=.2).length,3),a=(0,A._1)(e.score,.2,.8,0,1);n=this.currentAPY(t)*a*(1-(3-i)/10)}return n}computeCCNRewards(e,t){let n=0;if(e.score){let i=Math.min(e.crnsData.length,3),a=this.activeNodes(t).length,s=(0,A._1)(e.score,.2,.8,0,1);n=15e3/a*s*(1-(3-i)/10)}return n}constructor(e,t=l.Nr){this.account=e,this.channel=t}}let E=(0,s.memo)(e=>{let{node:t,nodes:n}=e,a=new z({}),r=a.computeEstimatedStakersAPY(t,n),o=a.currentAPY(n),l=r/o,c=(0,s.useMemo)(()=>t.crnsData.length<3||t.crnsData.find(e=>e.score<.2),[t]),d=(0,i.jsxs)(F,{children:[(0,i.jsx)(Z,{$performance:l}),Number(100*r).toFixed(2),"%"]});return(0,i.jsx)(i.Fragment,{children:c?(0,i.jsx)(p.u,{my:"top-center",at:"bottom-center",content:(0,i.jsxs)("div",{className:"fs-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[3-t.crnsData.length," missing CRN"]}),(0,i.jsx)("div",{className:"fs-xs",children:"Link 3 functioning CRN to that Node to maximise its rewards"})]}),(0,i.jsxs)("div",{children:["Performance: ",Number(100*l).toFixed(2),"%"]})]}),header:"Staking performance",children:d}):d})});E.displayName="APYCell";var F=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-y5e56o-0"})({display:"flex",alignItems:"center",gap:"0.75rem"});let T=a.ZP.div.withConfig({displayName:"styles__StyledProgressBar",componentId:"sc-1yxgl5m-0"})(e=>{let{theme:t,$percent:n}=e,i=n>=1?t.color.main1:t.color.main0,s="".concat(t.color.base0,"20");return[{position:"relative",height:"0.125rem",width:"100%"},(0,a.iv)(["background-color:",";&:after{"," content:'';background-color:",";width:","%;}"],s,{position:"absolute",left:"0px",top:"0px",height:"100%"},i,100*n)]}),B=(0,s.memo)(e=>{let{staked:t,status:n}=e,a=Number(t/1e3).toFixed(0);return(0,i.jsxs)(M,{className:"fs-xs",children:[(0,i.jsxs)(R,{className:"fs-xs",children:[(0,i.jsxs)("div",{children:[a,"k ",(0,i.jsx)(Y,{children:"of 500k"})]}),(0,i.jsx)("div",{className:"fs-xxs",children:n.toUpperCase()})]}),(0,i.jsx)(L,{children:(0,i.jsx)(T,{$percent:Math.min(t,5e5)/5e5})})]})});B.displayName="StakedCell";var M=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-mc9kar-0"})({lineHeight:"1rem"}),R=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv2",componentId:"sc-mc9kar-1"})({marginBottom:"0.625rem",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"0.375rem",whiteSpace:"nowrap",lineHeight:"1rem"}),Y=(0,a.ZP)("span").withConfig({displayName:"cmp___StyledSpan",componentId:"sc-mc9kar-2"})({opacity:"0.2"}),L=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv3",componentId:"sc-mc9kar-3"})({display:"flex",alignItems:"center",gap:"0.25rem"}),O=(0,a.ZP)("h1").withConfig({displayName:"cmp___StyledH",componentId:"sc-ujps5p-0"})({marginBottom:"2rem"}),H=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-ujps5p-1"})({marginBottom:"3.5rem",marginTop:"2rem"}),$=(0,a.ZP)("h2").withConfig({displayName:"cmp___StyledH2",componentId:"sc-ujps5p-2"})({marginBottom:"0px"}),q=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv2",componentId:"sc-ujps5p-3"})({marginTop:"3.5rem"}),K=(0,a.ZP)(p.mQ).withConfig({displayName:"cmp___StyledTabs",componentId:"sc-ujps5p-4"})({marginBottom:"2rem"}),G=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv3",componentId:"sc-ujps5p-5"})({display:"flex",justifyContent:"flex-end",gap:"0.75rem"}),J=function(){let[e,t]=(0,s.useState)("nodes");async function n(){let e=new m({});return await e.getCCNNodes()}let{data:a}=function(e){let{doRequest:t,triggerOnMount:n,triggerDeps:i=[],...a}=e,[r,{onLoad:o,onSuccess:l,onError:c}]=function(){let{onSuccess:e,onError:t,onLoad:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,p.lm)(),[a,r]=(0,s.useState)({data:null,loading:!1,error:null}),o=(0,s.useCallback)(t=>{function n(){i&&i.add({variant:"success",title:"Operation complete"})}return r({data:t,loading:!1,error:null}),e?e(t,n):n()},[i,e]),l=(0,s.useCallback)(e=>{function n(e){var t;let n=e.message,a=null===(t=null==e?void 0:e.cause)||void 0===t?void 0:t.message;i&&i.add({variant:"error",title:"Error",text:n,detail:a})}return r({data:null,loading:!1,error:e}),t?t(e,n):n(e)},[t,i]),c=(0,s.useCallback)(()=>{r({data:null,loading:!0,error:null}),n&&n()},[n]);return[a,{onSuccess:o,onError:l,onLoad:c}]}(a),d=(0,s.useCallback)(async()=>{o();try{let e=await t();l(e);return}catch(e){c(e)}},[t,o,l,c]);return(0,s.useEffect)(()=>{n&&d()},i),{...r,request:d}}({doRequest:n,triggerOnMount:!0});return console.log(a),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o(),{children:[(0,i.jsx)("title",{children:"Aleph.im | Account"}),(0,i.jsx)("meta",{name:"description",content:"Aleph.im Account Dashboard"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,i.jsxs)("section",{children:[(0,i.jsx)(O,{className:"tp-h5",children:"Staking"}),(0,i.jsxs)(H,{children:[(0,i.jsx)($,{className:"tp-h7",children:"What is staking?"}),(0,i.jsx)("p",{children:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum aliquam lectus non eros malesuada egestas eu vitae ipsum. Donec sed faucibus sapien. Interdum et malesuada fames ac ante ipsum primis in faucibus. Aenean at scelerisque tortor. Sed nec placerat lacus. Fusce facilisis arcu in vulputate eleifend. Pellentesque at ante est. Vivamus cursus lorem odio. Aenean porttitor rutrum erat sed suscipit. Duis viverra, ligula et lacinia lobortis, sem ante luctus sapien, id gravida justo odio vel sapien. Ut vel volutpat mauris, in congue lorem. Etiam mollis, magna at finibus dictum, metus diam malesuada felis, at mattis magna lectus eget enim."})]}),(0,i.jsxs)(q,{children:[(0,i.jsx)(K,{tabs:[{id:"stake",name:"My Stakes"},{id:"nodes",name:"All core nodes"}],align:"left",selected:e,onTabChange:t}),"stake"===e?(0,i.jsx)(i.Fragment,{children:"STAKE"}):(0,i.jsx)(i.Fragment,{children:a?(0,i.jsx)(u,{columns:[{label:"EST.APY",width:"10%",render:e=>(0,i.jsx)(E,{node:e,nodes:a})},{label:"NAME",width:"10%",render:e=>(0,i.jsx)(v,{hash:e.hash,name:e.name,picture:e.picture,locked:e.locked})},{label:"STAKED",width:"20%",render:e=>(0,i.jsx)(B,{staked:e.total_staked,status:e.status})},{label:"LINKED",width:"10%",render:e=>(0,i.jsx)(j,{nodes:e.resource_nodes})},{label:"SCORE",width:"20%",render:e=>(0,i.jsx)(P,{score:e.score})},{label:"",align:"right",width:"30%",render:()=>(0,i.jsxs)(G,{children:[(0,i.jsx)(p.zx,{kind:"neon",size:"regular",variant:"secondary",color:"main0",children:"Stake"}),(0,i.jsx)(p.zx,{kind:"neon",size:"regular",variant:"secondary",color:"main0",children:"Info"})]})}],data:a,borderType:"solid",oddRowNoise:!0}):(0,i.jsx)(i.Fragment,{children:"Loading..."})})]})]})]})}},70573:function(){},35883:function(){},78486:function(){},42480:function(){},75992:function(){},78110:function(){},28325:function(){},33370:function(){}},function(e){e.O(0,[390,733,956,845,78,626,852,861,572,162,774,888,179],function(){return e(e.s=44994)}),_N_E=e.O()}]);