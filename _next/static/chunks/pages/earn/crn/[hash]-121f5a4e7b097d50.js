(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{70805:function(e,n,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/earn/crn/[hash]",function(){return i(97172)}])},33378:function(e,n,i){"use strict";i.d(n,{Z:function(){return d}});var r=i(85893),a=i(19521),t=i(67294);let l=a.ZP.div.withConfig({displayName:"styles__StyledDotIcon",componentId:"sc-1w2vi58-0"})(e=>{let{theme:n,$active:i}=e,r=i?n.color.main1:"".concat(n.color.base0,"20");return[{height:"0.75rem",width:"0.5rem"},(0,a.iv)(["background-color:",";"],r)]}),s=e=>{let{decentralization:n}=e,i=e=>(e+1)*.3;return(0,r.jsx)(o,{children:(0,r.jsx)(c,{children:Array.from({length:3},(e,a)=>(0,r.jsx)(l,{$active:n>=i(a)},a))})})};s.displayName="NodeDecentralization";var d=(0,t.memo)(s),o=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-sktw9k-0"})({display:"inline-flex",alignItems:"center",gap:"0.75rem"}),c=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv2",componentId:"sc-sktw9k-1"})({display:"flex",alignItems:"stretch",gap:"0.125rem"})},67200:function(e,n,i){"use strict";i.d(n,{d:function(){return a}});var r=i(67294);function a(e){let{nodes:n}=e,i=(0,r.useMemo)(()=>{let e=n||Array.from({length:4},(e,n)=>({metricsData:{as_name:"Provider ".concat(n)}}));return e.reduce((e,n)=>{var i;let r=(null===(i=n.metricsData)||void 0===i?void 0:i.as_name)||"others";return e[r]=(e[r]||0)+1,e},{others:0})},[n]),a=(0,r.useMemo)(()=>Object.values(i).reduce((e,n)=>e+n,0),[i]),t=(0,r.useMemo)(()=>{let e=Object.entries(i).filter(e=>{let[n]=e;return"others"!==n}).sort((e,n)=>{let[,i]=e,[,r]=n;return r-i}),n=e.slice(0,3),r=e.slice(3),t=["others",i.others+r.reduce((e,n)=>{let[,i]=n;return e+i},0)];return[...n,t].map((e,n)=>{let[i,r]=e;return{tier:n+1,name:i,count:r,percentage:r/a,color:0===n?"error":1===n?"main2":2===n?"main0":"main1"}})},[i,a]);return{total:a,buckets:i,top:t}}},97172:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return U}});var r=i(85893),a=i(19521),t=i(67294),l=i(9008),s=i.n(l),d=i(94461),o=i(48107),c=i(11163),m=i(94527),u=i(15457),h=i(58193),v=i(10159),p=i(87536),x=i(56312),f=i(72771),j=i(91421),g=i(73384),w=i(67200),_=i(34853),N=i(41664),C=i.n(N),y=i(1218),b=i(68390),D=i(68732),k=i(8978),S=i(33378),E=i(77849),I=i(43666),Z=i(33358),A=i(25675),O=i.n(A),R=i(7954);let P=()=>{var e,n,i;let{node:a,nodesOnSameASN:l,baseLatency:N,lastMetricsCheck:A,calculatedRewards:P,isUserLinked:z,isLinkable:U,creationDate:q,nameCtrl:K,descriptionCtrl:X,bannerCtrl:V,pictureCtrl:$,managerCtrl:Q,isOwner:ee,isDirty:en,rewardCtrl:ei,streamRewardCtrl:er,addressCtrl:ea,asnTier:et,handleRemove:el,handleSubmit:es,handleLink:ed,handleUnlink:eo}=function(){let e=(0,c.useRouter)(),{hash:n}=e.query,[i]=(0,d.mr)(),{account:r}=i.account,{entities:a}=i.crns,{node:l}=function(e){let{hash:n}=e,[i]=(0,d.mr)(),{entities:r}=i.crns,a=(0,t.useMemo)(()=>{if(r)return r.filter(e=>e.hash===n)},[r,n]),[l]=a||[];return{node:l}}({hash:n}),{userNode:s}=(0,h.h)({}),_=(0,t.useMemo)(()=>new o.B(r),[r]);_.isUserLinked;let{calculatedRewards:N}=(0,m.H)({address:(null==l?void 0:l.reward)||""}),C=(0,u._)({node:l,nodes:a}),y=(0,t.useMemo)(()=>{if(l)return _.isUserLinked(l,s)},[l,_,s]),b=(0,t.useMemo)(()=>{if(l)return _.isLinkable(l,s)[0]},[l,_,s]),{handleLink:D,handleUnlink:k}=(0,g.i)(),S=(0,t.useCallback)(async()=>{if(!l)return;let n=await D(l.hash);n&&s&&e.replace("/earn/ccn/".concat(s.hash))},[D,e,l,s]),E=(0,t.useCallback)(async()=>{if(!l)return;let n=await k(l.hash);n&&s&&e.replace("/earn/ccn/".concat(null==s?void 0:s.hash))},[k,e,l,s]),{top:I}=(0,w.d)({nodes:a}),Z=I.find(e=>{var n;return e.name===(null==l?void 0:null===(n=l.metricsData)||void 0===n?void 0:n.as_name)}),A=(0,t.useMemo)(()=>({hash:null==l?void 0:l.hash,name:null==l?void 0:l.name,description:null==l?void 0:l.description,reward:null==l?void 0:l.reward,stream_reward:null==l?void 0:l.stream_reward,authorized:null==l?void 0:l.authorized,locked:null==l?void 0:l.locked,registration_url:null==l?void 0:l.registration_url,manager:null==l?void 0:l.manager,picture:null==l?void 0:l.picture,banner:null==l?void 0:l.banner,address:null==l?void 0:l.address}),[l]),O=function(e){let{defaultValues:n}=e,[i,r]=(0,d.mr)(),{account:a}=i.account,{entities:l}=i.crns,s=(0,f.lm)(),c=(0,t.useMemo)(()=>new o.B(a),[a]),m=(0,t.useCallback)(async e=>{if(!c)throw Error("Manager not ready");if(!a)throw Error("Invalid account");let[,n]=await c.updateComputeResourceNode(e),i=null==l?void 0:l.find(e=>e.hash===n.hash),r=function(e,n){let i={...e||{},...n,virtual:Date.now()};return i}(i,n);return r},[a,c,l]),u=(0,t.useCallback)(async e=>{if(!s)throw Error("Notification not ready");s.add({variant:"success",title:"Success",text:'Your node "'.concat(e.hash,'" was updated successfully.')}),r(new j.Wy({name:"crns",entities:[e]}))},[r,s]),{control:h,handleSubmit:g,formState:{errors:w,isDirty:_}}=(0,v.c)({defaultValues:n,onSubmit:m,onSuccess:u,resolver:(0,x.F)(o.B.updateCRNSchema),readyDeps:[n]}),N=(0,p.qo)({control:h}),C=(0,p.bc)({control:h,name:"name"}),y=(0,p.bc)({control:h,name:"description"}),b=(0,p.bc)({control:h,name:"address"}),D=(0,p.bc)({control:h,name:"picture"}),k=(0,p.bc)({control:h,name:"banner"}),S=(0,p.bc)({control:h,name:"reward"}),E=(0,p.bc)({control:h,name:"stream_reward"}),I=(0,p.bc)({control:h,name:"manager"}),Z=(0,p.bc)({control:h,name:"authorized"}),A=(0,p.bc)({control:h,name:"locked"}),O=(0,p.bc)({control:h,name:"registration_url"});return{values:N,control:h,nameCtrl:C,descriptionCtrl:y,addressCtrl:b,pictureCtrl:D,bannerCtrl:k,rewardCtrl:S,streamRewardCtrl:E,managerCtrl:I,authorizedCtrl:Z,lockedCtrl:A,registrationUrlCtrl:O,errors:w,isDirty:_,handleSubmit:g}}({defaultValues:A});return{nodes:a,node:l,userNode:s,calculatedRewards:N,isUserLinked:y,isLinkable:b,asnTier:Z,handleLink:S,handleUnlink:E,...O,...C}}();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s(),{children:[(0,r.jsx)("title",{children:"Aleph.im | CRN Detail"}),(0,r.jsx)("meta",{name:"description",content:"Aleph.im Compute Resource Node"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,r.jsx)("section",{children:(0,r.jsx)(y.Z,{node:a,nameCtrl:K,descriptionCtrl:X,bannerCtrl:V,pictureCtrl:$,isOwner:ee})}),ee&&(0,r.jsxs)(T,{children:[(0,r.jsxs)(f.zx,{kind:"flat",variant:"textOnly",size:"md",color:"error",onClick:el,children:[(0,r.jsx)(f.JO,{name:"trash",color:"error",size:"lg"}),"remove node"]}),(0,r.jsx)(f.zx,{kind:"neon",variant:"primary",size:"md",color:"main2",onClick:es,disabled:!en,children:"save changes"})]}),(0,r.jsx)(H,{children:(0,r.jsxs)(D.Z,{children:[(0,r.jsx)("div",{children:(0,r.jsxs)(b.ZP,{title:"GENERAL INFO",children:[(0,r.jsx)(k.Z,{status:null==a?void 0:a.status}),(0,r.jsx)(b.HC,{name:"NAME",value:null==a?void 0:a.name}),(0,r.jsx)(b.HC,{name:"ASN",value:null==a?void 0:null===(e=a.metricsData)||void 0===e?void 0:e.as_name}),(0,r.jsx)(b.HC,{name:"OWNER",value:(0,r.jsx)(I.Z,{href:(0,_.tz)({address:null==a?void 0:a.owner}),isOwner:!1,children:(null==a?void 0:a.owner)&&(0,_.zN)(null==a?void 0:a.owner)}),big:!0}),(0,r.jsx)(b.HC,{name:"REWARD ADDRESS",value:(0,r.jsx)(E.Z,{...ei.field,...ei.fieldState,placeholder:"reward address",isOwner:ee,children:(0,r.jsx)(I.Z,{href:(0,_.tz)({tokenAddress:ei.field.value}),isOwner:ee,children:ei.field.value&&(0,_.zN)(ei.field.value)})}),big:!0}),(0,r.jsx)(b.HC,{name:"STREAM REWARD ADDRESS",value:(0,r.jsx)(E.Z,{...er.field,...er.fieldState,placeholder:"PAYG reward address",isOwner:ee,children:(0,r.jsx)(I.Z,{href:(0,_.gl)({tokenAddress:er.field.value}),isOwner:ee,children:er.field.value&&(0,_.zN)(er.field.value)})}),big:!0}),(0,r.jsx)(b.HC,{name:"ADDRESS",value:(0,r.jsx)(E.Z,{...ea.field,...ea.fieldState,placeholder:"address",isOwner:ee,children:(0,r.jsx)(I.Z,{href:null==a?void 0:a.address,isOwner:ee,children:null==a?void 0:a.address})}),big:!0})]})}),(0,r.jsx)("div",{children:(0,r.jsx)(b.ZP,{title:"ADDITIONAL SETTINGS",children:(0,r.jsx)(b.HC,{name:"MANAGER",value:(0,r.jsx)(E.Z,{...Q.field,...Q.fieldState,placeholder:"manager address",isOwner:ee,children:(0,r.jsx)(I.Z,{href:(0,_.tz)({address:Q.field.value}),isOwner:ee,children:Q.field.value&&(0,_.zN)(Q.field.value)})}),big:!0})})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)(b.ZP,{title:"REWARD INDICATORS",children:[(0,r.jsx)(b.HC,{name:"NODES ON ASN",value:(0,r.jsxs)(M,{className:et&&"text-".concat(et.color),children:[l,!!et&&(0,r.jsx)(f.JO,{name:"hexagon-exclamation",color:et.color})]})}),(0,r.jsx)(b.HC,{name:"VERSION",value:null==a?void 0:null===(n=a.metricsData)||void 0===n?void 0:n.version}),(0,r.jsx)(b.HC,{name:"BASE LATENCY",value:N}),(0,r.jsx)(b.HC,{name:"LAST CHECK",value:A})]}),(0,r.jsx)(b.ZP,{title:"POTENTIAL REWARD",children:(0,r.jsx)(b.HC,{name:"ESTIMATED MONTHLY REWARD",value:(0,r.jsx)(R.Z,{value:P})})})]}),(0,r.jsx)("div",{children:(0,r.jsx)(b.ZP,{title:"LINKED CORE NODE",children:(null==a?void 0:a.parentData)?(0,r.jsxs)(J,{children:[(0,r.jsx)(C(),{href:"/earn/ccn/".concat(a.parentData.hash),legacyBehavior:!0,children:(0,r.jsx)(G,{hash:a.parentData.hash,name:a.parentData.name,picture:a.parentData.picture,apiServer:Z.pf,ImageCmp:O()})}),z?(0,r.jsx)("button",{onClick:eo,children:(0,r.jsx)(f.JO,{name:"trash",color:"error"})}):(0,r.jsx)(r.Fragment,{})]}):(0,r.jsxs)(L,{children:[(0,r.jsx)(W,{}),(0,r.jsx)(B,{className:"fs-10",children:!z&&U?(0,r.jsx)(f.zx,{color:"main2",size:"md",kind:"neon",variant:"textOnly",onClick:ed,children:(0,r.jsxs)("div",{children:[(0,r.jsx)(F,{name:"link"})," link now"]})}):(0,r.jsx)(r.Fragment,{children:"not linked"})})]})})}),(0,r.jsx)("div",{children:(0,r.jsxs)(b.ZP,{title:"DECENTRALIZED SCORE",children:[(0,r.jsxs)(Y,{className:et&&"text-".concat(et.color),children:[(0,r.jsx)(S.Z,{decentralization:(null==a?void 0:null===(i=a.scoreData)||void 0===i?void 0:i.decentralization)||0}),!!et&&(0,r.jsx)(f.JO,{name:"hexagon-exclamation",color:et.color})]}),!!et&&(0,r.jsxs)("p",{className:"tp-body3 fs-10",children:["There are ",l," nodes on this ASN. Please consider to migrate your node to a different ASN."]})]})}),(0,r.jsx)("div",{children:(0,r.jsx)(b.ZP,{title:"PERFORMANCE",children:(0,r.jsx)(b.HC,{name:"CREATION TIME",value:q})})})]})})]})};P.displayName="ComputeResourceNodeDetailPage";var z=(0,t.memo)(P),T=(0,a.ZP)("section").withConfig({displayName:"cmp___StyledSection",componentId:"sc-b9jk28-0"})({marginTop:"2rem",marginBottom:"2rem",display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"1.75rem"}),H=(0,a.ZP)("section").withConfig({displayName:"cmp___StyledSection2",componentId:"sc-b9jk28-1"})({marginTop:"2rem"}),M=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv",componentId:"sc-b9jk28-2"})({display:"flex",alignItems:"center",gap:"0.75rem"}),L=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv2",componentId:"sc-b9jk28-3"})({display:"inline-flex",alignItems:"center",gap:"0.75rem"}),W=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv3",componentId:"sc-b9jk28-4"})({height:"1.5rem",width:"1.5rem",borderRadius:"9999px",backgroundColor:"#C4C4C433"}),B=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv4",componentId:"sc-b9jk28-5"})({lineHeight:"1rem"}),F=(0,a.ZP)(f.JO).withConfig({displayName:"cmp___StyledIcon",componentId:"sc-b9jk28-6"})({height:"0.875rem",width:"0.875rem"}),J=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv5",componentId:"sc-b9jk28-7"})({display:"flex",alignItems:"center"}),G=(0,a.ZP)(f.tJ).withConfig({displayName:"cmp___StyledNodeName",componentId:"sc-b9jk28-8"})({marginRight:"auto",width:"auto",cursor:"pointer"}),Y=(0,a.ZP)("div").withConfig({displayName:"cmp___StyledDiv6",componentId:"sc-b9jk28-9"})({display:"flex",alignItems:"center",gap:"0.75rem"}),U=z}},function(e){e.O(0,[959,312,845,774,888,179],function(){return e(e.s=70805)}),_N_E=e.O()}]);