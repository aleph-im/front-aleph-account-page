"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{62922:function(e,t,r){var i,n,s,a,l,o,p,c,u,f,g,m;let h=Symbol("source_reference");class d extends Error{constructor(e,t,r){super(r),this.src=e,this.idx=t,Object.setPrototypeOf(this,d.prototype)}}(p=i||(i={}))[p.Comment=0]="Comment",p[p.Number=1]="Number",p[p.String=2]="String",p[p.Bytes=3]="Bytes",p[p.Ident=4]="Ident";let b=RegExp("\\s"),w=RegExp("[:@%_A-Za-z]"),y=RegExp("[@%_\\.A-Za-z0-9]"),E=/[0-9]/,P=/[0-9a-fA-F]/;function*A(e,t=!1){let r=0;for(;r<e.length;){for(;r<e.length&&b.test(e[r]);)r++;if(r===e.length)return;let n=e[r],s=r;if(w.test(n)){for(r++;r<e.length&&y.test(e[r]);)r++;yield{t:i.Ident,v:e.slice(s,r),first:s,last:r}}else if(e.length-r>1&&"0x"===e.substr(r,2)){for(r+=2;r<e.length&&P.test(e[r]);)r++;if((r-s&1)!=0)throw new d(e,r,"Bytes literal length is expected to be power of two");yield{t:i.Bytes,v:e.slice(s,r),first:s,last:r}}else if(E.test(n)||"-"===n){"-"===n&&r++;let t=r;for(;r<e.length&&E.test(e[r]);)r++;if(t===r)throw new d(e,r,"Number literal is too short");yield{t:i.Number,v:e.slice(s,r),first:s,last:r}}else if('"'===n){r++;let t=!1;for(;r<e.length&&(t||'"'!==e[r]);r++)t=!t&&"\\"===e[r];if(r===e.length)throw new d(e,r,"Unterminated string literal");r++,yield{t:i.String,v:e.slice(s,r),first:s,last:r}}else if("#"===n){for(r++;r<e.length&&"\n"!==e[r];)r++;t&&(yield{t:i.Comment,v:e.slice(s,r),first:s,last:r})}else if(e.length-r>1&&"/*"===e.substr(r,2)){for(r+=2;r<e.length&&!(e.length-r>1&&"*/"===e.substr(r,2));)r++;if(r===e.length)throw new d(e,r,"Unterminated C style comment");r+=2,t&&(yield{t:i.Comment,v:e.slice(s,r),first:s,last:r})}else if("("===n||")"===n||"{"===n||"}"===n||";"===n)r++,yield{t:n,v:n,first:s,last:r};else throw new d(e,r,`Invalid character at offset ${r}: \`${n}'`)}}let v=Symbol("ref_contract");(c=n||(n={})).Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",c.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",c.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",c.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",c.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",c.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",c.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",c.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",c.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",c.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",c.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",c.PsFLoren="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",c.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",c.PtGRANAD="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",c.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",c.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",c.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",c.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",c.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",c.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",c.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",c.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",c.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",c.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",c.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",c.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK";let S=n.Psithaca2,T={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW:15,PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc:16,PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1:16,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:17};function _(e,t){return T[e]<T[t]}class I extends Error{constructor(e,t){super(t),this.prim=e,Object.setPrototypeOf(this,I.prototype)}}function C(e,t){var r,i;if(0===t&&void 0===e.args||(null===(r=e.args)||void 0===r?void 0:r.length)===t)return!0;throw new I(e,`macro ${e.prim} expects ${t} arguments, was given ${null===(i=e.args)||void 0===i?void 0:i.length}`)}function x(e){if(void 0===e.annots)return!0;throw new I(e,`unexpected annotation on macro ${e.prim}: ${e.annots}`)}function N(e,t){if("int"in t)return!0;throw new I(e,`macro ${e.prim} expects int argument`)}function O(e,t,r,i){let n,s,a=0,l=0,o=[null,null];if(a===t.length)throw new I(e,`unexpected end: ${e.prim}`);let p=t[a++];switch(p){case"P":{let{r:s,n:o,an:p}=O(e,t.slice(a),r.slice(l),i);n=s,a+=o,l+=p;break}case"A":l!==r.length&&(o[0]=r[l++]);break;default:throw new I(e,`${e.prim}: unexpected character: ${p}`)}if(a===t.length)throw new I(e,`unexpected end: ${e.prim}`);switch(p=t[a++]){case"P":{let{r:n,n:o,an:p}=O(e,t.slice(a),r.slice(l),i);s=n.map(([e,t])=>[e+1,t]),a+=o,l+=p;break}case"I":l!==r.length&&(o[1]=r[l++]);break;default:throw new I(e,`${e.prim}: unexpected character: ${p}`)}return{r:i(n,s,[0,o]),n:a,an:l}}function R(e,t,r,i){let n=t[0];switch(n){case"A":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},R(e,t.slice(1),[],i)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...r]}]:i.a;case"D":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},R(e,t.slice(1),[],i)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...r]}]:i.d;default:throw new I(e,`${e.prim}: unexpected character: ${n}`)}}function L(e){let t=[],r=[];if(void 0!==e)for(let i of e)(0!==i.length&&"%"===i[0]?t:r).push(i);return{fields:t,rest:r}}function $({prim:e,annots:t,args:r}){return Object.assign(Object.assign({prim:e},t&&{annots:t}),r&&{args:r})}let D=/^P[PAI]{3,}R$/,k=/^UNP[PAI]{2,}R$/,M=/^C[AD]{2,}R$/,K=/^SET_C[AD]+R$/,U=/^MAP_C[AD]+R$/,F=/^DI{2,}P$/,H=/^DU+P$/;class G extends Error{constructor(e,t){super(t),this.token=e,Object.setPrototypeOf(this,G.prototype)}}class J extends Error{constructor(e,t){super(t),this.node=e,Object.setPrototypeOf(this,J.prototype)}}let j=new G(null,"Unexpected EOF");function B(e){return e.t===i.Ident&&("@"===e.v[0]||"%"===e.v[0]||":"===e.v[0])}let Y=RegExp("^-?[0-9]+$"),z=RegExp("^([0-9a-fA-F]{2})*$");class W{constructor(e){this.opt=e}expand(e){var t,r,i,s;if((null===(t=this.opt)||void 0===t?void 0:t.expandGlobalConstant)!==void 0&&"constant"===e.prim){let t=(s=this.opt.expandGlobalConstant,void 0!==e.args&&1===e.args.length&&"string"in e.args[0]&&e.args[0].string in s?s[e.args[0].string]:e);return t!==e&&(t[h]=Object.assign(Object.assign({},e[h]||{first:0,last:0}),{globalConstant:e})),t}if((null===(r=this.opt)||void 0===r?void 0:r.expandMacros)!==void 0&&(null===(i=this.opt)||void 0===i||!i.expandMacros))return e;{let t=function(e,t){let r=(null==t?void 0:t.protocol)||S;function i(e){return void 0!==e?[{prim:"RENAME",annots:e}]:[]}switch(e.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(C(e,0))return[{prim:"COMPARE"},$({prim:e.prim.slice(3),annots:e.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(C(e,2))return[{prim:e.prim.slice(2)},$({prim:"IF",annots:e.annots,args:e.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(C(e,2))return[{prim:"COMPARE"},{prim:e.prim.slice(5)},$({prim:"IF",annots:e.annots,args:e.args})];break;case"FAIL":if(C(e,0)&&x(e))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(C(e,0)&&x(e))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(C(e,0)&&x(e))return[{prim:e.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(C(e,0)&&x(e))return[[{prim:"COMPARE"},{prim:e.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(C(e,0)&&x(e))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(C(e,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(e.annots)]}];break;case"ASSERT_LEFT":if(C(e,0))return[{prim:"IF_LEFT",args:[i(e.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(C(e,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(e.annots)]}];break;case"IF_SOME":if(C(e,2))return[$({prim:"IF_NONE",annots:e.annots,args:[e.args[1],e.args[0]]})];break;case"IF_RIGHT":if(C(e,2))return[$({prim:"IF_LEFT",annots:e.annots,args:[e.args[1],e.args[0]]})];break;case"CAR":case"CDR":if(void 0===e.args)return e;if(C(e,1)&&N(e,e.args[0])){let t=parseInt(e.args[0].int,10);return $({prim:"GET",args:[{int:"CAR"===e.prim?String(2*t+1):String(2*t)}],annots:e.annots})}}if(D.test(e.prim)&&C(e,0)){let{fields:t,rest:r}=L(e.annots),{r:i}=O(e,e.prim.slice(1),t,(e,t,r)=>[...e||[],...t||[],r]);return i.map(([e,t],n)=>{let s=[...(function(e,t){let r=e.length;for(;r>0&&null===e[r-1];)r--;return e.slice(0,r)})(t,0).map(e=>null===e?"%":e),...0===e&&n===i.length-1?r:[]],a=$({prim:"PAIR",annots:0!==s.length?s:void 0});return 0===e?a:{prim:"DIP",args:1===e?[[a]]:[{int:String(e)},[a]]}})}if(k.test(e.prim)){if(_(r,n.PtEdo2Zk)&&C(e,0)){let{r:t}=O(e,e.prim.slice(3),e.annots||[],(e,t,r)=>[r,...t||[],...e||[]]);return t.map(([e,t])=>{let r=[{prim:"DUP"},$({prim:"CAR",annots:null!==t[0]?[t[0]]:void 0}),{prim:"DIP",args:[[$({prim:"CDR",annots:null!==t[1]?[t[1]]:void 0})]]}];return 0===e?r:{prim:"DIP",args:1===e?[[r]]:[{int:String(e)},[r]]}})}if("UNPAIR"===e.prim)return e;if(C(e,0)){let{r:t}=O(e,e.prim.slice(3),[],(e,t,r)=>[r,...t||[],...e||[]]);return t.map(([e])=>{let t=$({prim:"UNPAIR"});return 0===e?t:{prim:"DIP",args:1===e?[[t]]:[{int:String(e)},[t]]}})}}if(M.test(e.prim)&&C(e,0)){let t=[...e.prim.slice(1,e.prim.length-1)];return t.map((r,i)=>{let n=i===t.length-1?e.annots:void 0;switch(r){case"A":return $({prim:"CAR",annots:n});case"D":return $({prim:"CDR",annots:n});default:throw new I(e,`unexpected character: ${r}`)}})}if(K.test(e.prim)&&C(e,0)){let{fields:t,rest:r}=L(e.annots);if(t.length>1)throw new I(e,`unexpected annotation on macro ${e.prim}: ${t}`);let i=0!==t.length?{a:[{prim:"DUP"},{prim:"CAR",annots:t},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[t[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:t},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",t[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return R(e,e.prim.slice(5,e.prim.length-1),r,i)}if(U.test(e.prim)&&C(e,1)){let{fields:t}=L(e.annots);if(t.length>1)throw new I(e,`unexpected annotation on macro ${e.prim}: ${t}`);let r={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[$({prim:"CAR",annots:0!==t.length?["@"+t[0].slice(1)]:void 0}),e.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[0!==t.length?t[0]:"%","%@"]}],d:[{prim:"DUP"},$({prim:"CDR",annots:0!==t.length?["@"+t[0].slice(1)]:void 0}),e.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",0!==t.length?t[0]:"%"]}]};return R(e,e.prim.slice(5,e.prim.length-1),[],r)}if(F.test(e.prim)&&C(e,1)){let t=0;for(;"I"===e.prim[1+t];)t++;return $({prim:"DIP",args:[{int:String(t)},e.args[0]]})}if(H.test(e.prim)){let t=0;for(;"U"===e.prim[1+t];)t++;if(_(r,n.PtEdo2Zk)){if(1===t){if(void 0===e.args)return e;C(e,1)&&N(e,e.args[0])&&(t=parseInt(e.args[0].int,10))}else C(e,0);return 1===t?[$({prim:"DUP",annots:e.annots})]:2===t?[{prim:"DIP",args:[[$({prim:"DUP",annots:e.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(t-1)},[$({prim:"DUP",annots:e.annots})]]},{prim:"DIG",args:[{int:String(t)}]}]}if(1===t)return e;if(C(e,0))return $({prim:"DUP",args:[{int:String(t)}],annots:e.annots})}return e}(e,this.opt);return t!==e&&(t[h]=Object.assign(Object.assign({},e[h]||{first:0,last:0}),{macro:e})),t}}parseListExpr(e,t){var r;let n;let s={first:t.first,last:t.last},a="("===t.t;if(a){if((n=e.next()).done)throw j;s.last=n.value.last}else n={value:t};if(n.value.t!==i.Ident)throw new G(n.value,`not an identifier: ${n.value.v}`);let l={prim:n.value.v,[h]:s};for(;;){let t=e.next();if(t.done){if(a)throw j;break}if(")"===t.value.t){if(!a)throw new G(t.value,"unexpected closing bracket");s.last=t.value.last;break}if(B(t.value))l.annots=l.annots||[],l.annots.push(t.value.v),s.last=t.value.last;else{l.args=l.args||[];let i=this.parseExpr(e,t.value);s.last=(null===(r=i[h])||void 0===r?void 0:r.last)||s.last,l.args.push(i)}}return this.expand(l)}parseArgs(e,t){var r;let i={first:t.first,last:t.last},n={prim:t.v,[h]:i};for(;;){let t=e.next();if(t.done||"}"===t.value.t||";"===t.value.t)return[n,t];if(B(t.value))i.last=t.value.last,n.annots=n.annots||[],n.annots.push(t.value.v);else{let s=this.parseExpr(e,t.value);i.last=(null===(r=s[h])||void 0===r?void 0:r.last)||i.last,n.args=n.args||[],n.args.push(s)}}}parseSequenceExpr(e,t){var r,n;let s={first:t.first,last:t.last},a=[];a[h]=s;let l="{"===t.t,o="{"===t.t?null:{value:t};for(;;){if(null!==o||(o=e.next()).done||(s.last=o.value.last),o.done){if(!l)return a;throw j}if("}"===o.value.t){if(l)return a;throw new G(o.value,"unexpected closing bracket")}if(o.value.t===i.Ident){let[t,i]=this.parseArgs(e,o.value);s.last=(null===(r=t[h])||void 0===r?void 0:r.last)||s.last,a.push(this.expand(t)),o=i}else{let t=this.parseExpr(e,o.value);s.last=(null===(n=t[h])||void 0===n?void 0:n.last)||s.last,a.push(t),o=null}null!==o||(o=e.next()).done||(s.last=o.value.last),o.done||";"!==o.value.t||(o=null)}}parseExpr(e,t){switch(t.t){case i.Ident:return this.expand({prim:t.v,[h]:{first:t.first,last:t.last}});case i.Number:return{int:t.v,[h]:{first:t.first,last:t.last}};case i.String:return{string:JSON.parse(t.v),[h]:{first:t.first,last:t.last}};case i.Bytes:return{bytes:t.v.slice(2),[h]:{first:t.first,last:t.last}};case"{":return this.parseSequenceExpr(e,t);default:return this.parseListExpr(e,t)}}parseSequence(e){if("string"!=typeof e)throw TypeError(`string type was expected, got ${typeof e} instead`);let t=A(e),r=t.next();return r.done?null:this.parseSequenceExpr(t,r.value)}parseList(e){if("string"!=typeof e)throw TypeError(`string type was expected, got ${typeof e} instead`);let t=A(e),r=t.next();return r.done?null:this.parseListExpr(t,r.value)}parseMichelineExpression(e){if("string"!=typeof e)throw TypeError(`string type was expected, got ${typeof e} instead`);let t=A(e),r=t.next();return r.done?null:this.parseExpr(t,r.value)}parseScript(e){return this.parseSequence(e)}parseData(e){return this.parseList(e)}parseJSON(e){if("object"!=typeof e)throw TypeError(`object type was expected, got ${typeof e} instead`);if(Array.isArray(e)){let t=[];for(let r of e){if(null===r||"object"!=typeof r)throw new J(r,`unexpected sequence element: ${r}`);t.push(this.parseJSON(r))}return t}if("prim"in e){if("string"==typeof e.prim&&(void 0===e.annots||Array.isArray(e.annots))&&(void 0===e.args||Array.isArray(e.args))){let t={prim:e.prim};if(void 0!==e.annots){for(let t of e.annots)if("string"!=typeof t)throw new J(t,`string expected: ${t}`);t.annots=e.annots}if(void 0!==e.args)for(let r of(t.args=[],e.args)){if(null===r||"object"!=typeof r)throw new J(r,`unexpected argument: ${r}`);t.args.push(this.parseJSON(r))}return this.expand(t)}throw new J(e,`malformed prim expression: ${e}`)}if("string"in e){if("string"==typeof e.string)return{string:e.string};throw new J(e,`malformed string literal: ${e}`)}if("int"in e){if("string"==typeof e.int&&Y.test(e.int))return{int:e.int};throw new J(e,`malformed int literal: ${e}`)}if("bytes"in e){if("string"==typeof e.bytes&&z.test(e.bytes))return{bytes:e.bytes};throw new J(e,`malformed bytes literal: ${e}`)}throw new J(e,`unexpected object: ${e}`)}}let V=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],q=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class Q extends Error{constructor(e){super(e),this.message=e,this.name="Base58DecodingError"}}class Z extends Error{constructor(e){super(e),this.message=e,this.name="InvalidMessageError"}}function X(e){let t=(e.length+9)%64;if(e.length>268435455)throw new Z(`SHA-256 -- message length is too big: ${e.length}`);let r=e.length<<3,i=[...e,128,...Array(0===t?0:64-t).fill(0),0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r];function n(e,t){return e>>>t|e<<32-t}let s=[...V],a=Array(64),l=Array(8);for(let e=0;e<i.length;e+=64){let t=e,r=0;for(;r<16;)a[r]=i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3],t+=4,r++;for(;r<64;){let e=n(a[r-15],7)^n(a[r-15],18)^a[r-15]>>>3,t=n(a[r-2],17)^n(a[r-2],19)^a[r-2]>>>10;a[r]=(0|t)+a[r-7]+e+a[r-16]|0,r++}for(let e=0;e<8;e++)l[e]=s[e];for(let e=0;e<64;e++){let t=n(l[0],2)^n(l[0],13)^n(l[0],22),r=n(l[4],6)^n(l[4],11)^n(l[4],25),i=l[7]+r+(l[4]&l[5]^~l[4]&l[6])+q[e]+a[e]|0,s=t+(l[0]&l[1]^l[0]&l[2]^l[1]&l[2])|0;l[7]=l[6],l[6]=l[5],l[5]=l[4],l[4]=l[3]+i|0,l[3]=l[2],l[2]=l[1],l[1]=l[0],l[0]=i+s|0}for(let e=0;e<8;e++)s[e]=s[e]+l[e]|0}let o=[];for(let e of s)o.push(e>>24&255),o.push(e>>16&255),o.push(e>>8&255),o.push(255&e);return o}let ee=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57],et=[0,1,2,3,4,5,6,7,8,16,17,18,19,20,21,22,23,25,26,27,28,29,31,32,33,34,35,36,37,38,39,40,41,48,49,50,51,52,53,54,55,56,57,58,60,61,62,63,64,65,66,67,68,69,70,71,72,73];function er(e,t){let r=e.charCodeAt(t)-49;if(r>=ee.length||-1===ee[r])throw new Q(`Unexpected character at position ${t}: ${e[t]}`);return ee[r]}function ei(e){let t=function(e){let t=[],r=0;for(;r<e.length&&0===er(e,r);)r++;let i=r;for(;r<e.length;){let i=er(e,r++),n=0;for(;0!==i||n<t.length;){let e=58*(t[n]||0)+i;t[n++]=e%256,i=Math.floor(e/256)}}for(;i-- >0;)t.push(0);return t.reverse()}(e);if(t.length<4)throw new Q(`Data is too short ${t.length}`);let r=t.slice(0,t.length-4),i=t.slice(t.length-4),n=X(X(r));if(i[0]!==n[0]||i[1]!==n[1]||i[2]!==n[2]||i[3]!==n[3])throw new Q("Invalid checksum");return r}class en extends Error{constructor(e){super(e),this.message=e,this.name="InvalidContractError"}}class es extends Error{constructor(e){super(e),this.message=e,this.name="InvalidTypeExpressionError"}}class ea extends Error{constructor(e){super(e),this.message=e,this.name="InvalidDataExpressionError"}}class el extends Error{constructor(e){super(`Contract has no entrypoint named: '${e}'`),this.entrypoint=e,this.name="InvalidEntrypointError"}}class eo extends Error{constructor(e){super(e),this.message=e,this.name="TezosIdEncodeError"}}class ep extends Error{constructor(e){super(e),this.message=e,this.name="LongIntegerError"}}class ec extends Error{constructor(e,t){super(t),this.val=e,Object.setPrototypeOf(this,ec.prototype)}}class eu extends ec{constructor(e,t,r){super(e,r),void 0!==t&&(this.data=t),Object.setPrototypeOf(this,eu.prototype)}}class ef{constructor(e){if(this.neg=!1,this.buf=[],void 0===e)return;if("string"==typeof e)for(let t=0;t<e.length;t++){let r=e.charCodeAt(t);if(0===t&&45===r)this.neg=!0;else{if(r<48||r>57)throw new ep(`unexpected character in integer constant: ${e[t]}`);this.append(r-48)}}else e<0?(this.neg=!0,this.append(-e)):this.append(e)}append(e){let t=0;for(;0!==e||t<this.buf.length;){let r=10*(this.buf[t]||0)+e;this.buf[t++]=r%256,e=Math.floor(r/256)}}cmp(e){if(this.neg!==e.neg)return(e.neg?1:0)-(this.neg?1:0);{let t=0;if(this.buf.length!==e.buf.length)t=this.buf.length<e.buf.length?-1:1;else if(0!==this.buf.length){let r=e.buf.length-1;for(;r>=0&&this.buf[r]===e.buf[r];)r--;t=r<0?0:this.buf[r]<e.buf[r]?-1:1}return this.neg?0===t?0:-t:t}}get sign(){return 0===this.buf.length?0:this.neg?-1:1}}function eg(e){let t=[];for(let r=0;r<e.length;r+=2){let i=parseInt(e.slice(r,r+2),16);if(Number.isNaN(i))return null;t.push(i)}return t}function em(e){try{return new ef(e),!0}catch(e){return!1}}function eh(e){try{return new ef(e).sign>=0}catch(e){return!1}}let ed=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function eb(e,t){let r,i,n;if(Array.isArray(e))return{};if(void 0!==e.annots){for(let s of e.annots)if(0!==s.length){if(!ed.test(s)||!(null==t?void 0:t.specialVar)&&("@%"===s||"@%%"===s)||!(null==t?void 0:t.specialFields)&&"%@"===s)throw new ec(e,`${e.prim}: unexpected annotation: ${s}`);switch(s[0]){case"%":((null==t?void 0:t.emptyFields)||s.length>1)&&(r=r||[]).push(s);break;case":":s.length>1&&(i=i||[]).push(s);break;case"@":((null==t?void 0:t.emptyVar)||s.length>1)&&(n=n||[]).push(s)}}}return{f:r,t:i,v:n}}let ew={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]],TxRollupL2Address:[20,[6,161,166]]};function ey(e,...t){let r=ei(e);for(let e of t){let[t,i]=ew[e];if(r.length===t+i.length){let t=0;for(;t<i.length&&r[t]===i[t];)t++;if(t===i.length)return[e,r.slice(i.length)]}}return null}function eE(e,t){let[r,i]=ew[e];if(t.length!==r)throw new eo(`Incorrect data length for ${e}: ${t.length}`);return function(e){let t=X(X(e));return function(e){let t=[],r=0;for(;r<e.length&&0===e[r];)r++;let i=r;for(;r<e.length;){let i=e[r++],n=0;for(;0!==i||n<t.length;){let e=256*(t[n]||0)+i;t[n++]=e%58,i=Math.floor(e/58)}}for(;i-- >0;)t.push(0);return t.reverse(),String.fromCharCode(...t.map(e=>et[e]+49))}([...e,...t.slice(0,4)])}([...i,...t])}function eP(e,t){let r=Array.isArray(t)?t:t.args;return 2===r.length?"pair"===e?{prim:"pair",args:r}:{prim:"Pair",args:r}:Object.assign(Object.assign({},Array.isArray(t)?{prim:e}:t),{args:[r[0],{prim:e,args:r.slice(1)}]})}function eA(e){return Array.isArray(e)||"pair"===e.prim}function ev(e){return Array.isArray(e)||"prim"in e&&"Pair"===e.prim}let eS=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function eT(e){if("string"in e){if(eh(e.string))return new Date(parseInt(e.string,10));if(eS.test(e.string)){let t=new Date(e.string);if(!Number.isNaN(t.valueOf))return t}}else if(em(e.int))return new Date(parseInt(e.int,10));return null}function e_(e){return e.map(e=>(e>>4&15).toString(16)+(15&e).toString(16)).join("")}let eI={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TICKET_DEPRECATED:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0,BYTES:!0,NAT:!0},eC=Object.assign({},eI,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMIT:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LAMBDA_REC:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),ex={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},eN=Object.assign({},ex,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_transaction_deprecated:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class eO extends ec{constructor(e,t){super(e,t),this.val=e,Object.setPrototypeOf(this,eO.prototype)}}function eR(e){return"prim"in e}function eL(e){if(eR(e))return!0;throw new eO(e,"prim expression expected")}function e$(e){if(Array.isArray(e))return!0;throw new eO(e,"sequence expression expected")}function eD(e){if(Array.isArray(e)||"prim"in e)return!0;throw new eO(e,"prim or sequence expression expected")}function ek(e){if("-"===e.int[0])throw new eO(e,"natural number expected")}function eM(e){if("int"in e)return!0;throw new eO(e,"int literal expected")}function eK(e){if("string"in e)return!0;throw new eO(e,"string literal expected")}function eU(e,t){var r;if(0===t&&void 0===e.args||(null===(r=e.args)||void 0===r?void 0:r.length)===t)return!0;throw new eO(e,`${t} arguments expected`)}function eF(e){var t,r;if(Array.isArray(e)){for(let t of e){if(!Array.isArray(t)&&!eR(t))throw new eO(e,"sequence or prim expected");eF(t)}return!0}if(eL(e)){if(Object.prototype.hasOwnProperty.call(eI,e.prim))return eU(e,0),!0;switch(e.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":void 0!==e.args&&eU(e,1)&&eM(e.args[0])&&ek(e.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":eU(e,1)&&eM(e.args[0])&&ek(e.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":eU(e,1)&&eV(e.args[0]);break;case"UNPACK":eU(e,1)&&eG(e.args[0]);break;case"CONTRACT":eU(e,1)&&eB(e.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":eU(e,2)&&(e$(e.args[0])&&eF(e.args[0]),e$(e.args[1])&&eF(e.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":eU(e,1)&&eF(e.args[0]);break;case"CREATE_CONTRACT":eU(e,1)&&eZ(e.args[0]);break;case"DIP":if((null===(t=e.args)||void 0===t?void 0:t.length)===2)eM(e.args[0])&&ek(e.args[0]),e$(e.args[1])&&eF(e.args[1]);else if((null===(r=e.args)||void 0===r?void 0:r.length)===1)e$(e.args[0])&&eF(e.args[0]);else throw new eO(e,"1 or 2 arguments expected");break;case"PUSH":eU(e,2)&&(eJ(e.args[0]),eQ(e.args[1]));break;case"EMPTY_SET":eU(e,1)&&eH(e.args[0]);break;case"EMPTY_MAP":eU(e,2)&&(eH(e.args[0]),eV(e.args[1]));break;case"EMPTY_BIG_MAP":eU(e,2)&&(eH(e.args[0]),eY(e.args[1]));break;case"LAMBDA_REC":case"LAMBDA":eU(e,3)&&(eV(e.args[0]),eV(e.args[1]),e$(e.args[2])&&eF(e.args[2]));break;case"VIEW":eU(e,2)&&(eK(e.args[0])&&eW(e.args[0]),eV(e.args[1])&&eJ(e.args[1]));break;case"EMIT":e.args&&e.args.length>0?eU(e,1):eU(e,0);break;default:throw new eO(e,"instruction expected")}}return!0}function eH(e){if(eD(e)){if(Array.isArray(e)||"pair"===e.prim||"or"===e.prim||"option"===e.prim)eq(e,e=>eH(e));else if(!Object.prototype.hasOwnProperty.call(ex,e.prim))throw new eO(e,`${e.prim}: type is not comparable`)}return!0}function eG(e){if(eD(e)&&eR(e)){if(!Object.prototype.hasOwnProperty.call(eN,e.prim)||"big_map"===e.prim||"operation"===e.prim||"sapling_state"===e.prim||"ticket"===e.prim)throw new eO(e,`${e.prim}: type can't be used inside PACK/UNPACK instructions`);eq(e,e=>eG(e))}return!0}function eJ(e){if(eD(e)&&eR(e)){if(!Object.prototype.hasOwnProperty.call(eN,e.prim)||"big_map"===e.prim||"operation"===e.prim||"sapling_state"===e.prim||"ticket"===e.prim||"contract"===e.prim)throw new eO(e,`${e.prim}: type can't be pushed`);eq(e,e=>eJ(e))}return!0}function ej(e){if(eD(e)&&eR(e)){if(!Object.prototype.hasOwnProperty.call(eN,e.prim)||"operation"===e.prim||"contract"===e.prim)throw new eO(e,`${e.prim}: type can't be used as part of a storage`);eq(e,e=>ej(e))}return!0}function eB(e){if(eD(e)&&eR(e)){if(!Object.prototype.hasOwnProperty.call(eN,e.prim)||"operation"===e.prim)throw new eO(e,`${e.prim}: type can't be used as part of a parameter`);eq(e,e=>eB(e))}return!0}function eY(e){if(eD(e)&&eR(e)){if(!Object.prototype.hasOwnProperty.call(eN,e.prim)||"big_map"===e.prim||"operation"===e.prim||"sapling_state"===e.prim)throw new eO(e,`${e.prim}: type can't be used inside a big_map`);eq(e,e=>eY(e))}return!0}let ez=RegExp("^[a-zA-Z0-9_.%@]*$");function eW(e){if(e.string.length>31)throw new eO(e,`view name too long: ${e.string}`);if(!ez.test(e.string))throw new eO(e,`invalid character(s) in view name: ${e.string}`)}function eV(e){if(eD(e)&&eR(e)){if(!Object.prototype.hasOwnProperty.call(eN,e.prim))throw new eO(e,"type expected");eq(e,e=>eV(e))}return!0}function eq(e,t){if(Array.isArray(e)||"pair"===e.prim){let r=Array.isArray(e)?e:e.args;if(void 0===r||r.length<2)throw new eO(e,"at least 2 arguments expected");return r.forEach(e=>{eD(e)&&t(e)}),!0}switch(e.prim){case"option":case"list":eU(e,1)&&eD(e.args[0])&&t(e.args[0]);break;case"contract":eU(e,1)&&eB(e.args[0]);break;case"or":eU(e,2)&&eD(e.args[0])&&eD(e.args[1])&&(t(e.args[0]),t(e.args[1]));break;case"lambda":eU(e,2)&&(eV(e.args[0]),eV(e.args[1]));break;case"set":eU(e,1)&&eH(e.args[0]);break;case"map":eU(e,2)&&eD(e.args[0])&&eD(e.args[1])&&(eH(e.args[0]),t(e.args[1]));break;case"big_map":eU(e,2)&&eD(e.args[0])&&eD(e.args[1])&&(eH(e.args[0]),eY(e.args[1]),t(e.args[1]));break;case"ticket":eU(e,1)&&eD(e.args[0])&&eH(e.args[0]);break;case"sapling_state":case"sapling_transaction":eU(e,1)&&eM(e.args[0]);break;default:eU(e,0)}return!0}function eQ(e){if("int"in e||"string"in e||"bytes"in e)return!0;if(Array.isArray(e)){let t=0;for(let r of e)eR(r)&&"Elt"===r.prim?(eU(r,2)&&(eQ(r.args[0]),eQ(r.args[1])),t++):eQ(r);if(0!==t&&t!==e.length)throw new eO(e,"data entries and map elements can't be intermixed");return!0}if(eR(e))switch(e.prim){case"Unit":case"True":case"False":case"None":eU(e,0);break;case"Pair":if(void 0===e.args||e.args.length<2)throw new eO(e,"at least 2 arguments expected");for(let t of e.args)eQ(t);break;case"Left":case"Right":case"Some":eU(e,1)&&eQ(e.args[0]);break;case"Lambda_rec":e.args&&eF(e.args);break;default:if(Object.prototype.hasOwnProperty.call(eC,e.prim))eF(e);else throw new eO(e,"data entry or instruction expected")}else throw new eO(e,"data entry expected");return!0}function eZ(e){if(e$(e)){let t={},r={};for(let i of e)if(eL(i)){if("view"!==i.prim){if(i.prim in t)throw new eO(e,`duplicate contract section: ${i.prim}`);t[i.prim]=!0}switch(i.prim){case"code":eU(i,1)&&e$(i.args[0])&&eF(i.args[0]);break;case"parameter":if(eU(i,1)&&eB(i.args[0]),i.annots)throw new eO(i,"Annotation must be part of the parameter type");break;case"storage":eU(i,1)&&ej(i.args[0]);break;case"view":if(eU(i,4)){if(eK(i.args[0])){let t=i.args[0];if(t.string in r)throw new eO(e,`duplicate view name: ${t.string}`);r[t.string]=!0,eW(t)}eJ(i.args[1]),eJ(i.args[2]),e$(i.args[3])&&eF(i.args[3])}break;default:throw new eO(e,`unexpected contract section: ${i.prim}`)}}}return!0}function eX(e){return Object.prototype.hasOwnProperty.call(eC,e.prim)}function e0(e){if(!Array.isArray(e))return!1;for(let t of e)if("prim"in t){if(eX(t))throw new ec(e,`Instruction outside of a lambda: ${JSON.stringify(e)}`);if("Elt"===t.prim)throw new ec(e,`Elt item outside of a map literal: ${JSON.stringify(e)}`)}return!0}Object.assign({},...["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction_deprecated","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET_DEPRECATED","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ","tx_rollup_l2_address","MIN_BLOCK_TIME","sapling_transaction","EMIT","Lambda_rec","LAMBDA_REC","TICKET","BYTES","NAT"].map((e,t)=>({[e]:t}))),(u=s||(s={}))[u.Int=0]="Int",u[u.String=1]="String",u[u.Sequence=2]="Sequence",u[u.Prim0=3]="Prim0",u[u.Prim0Annot=4]="Prim0Annot",u[u.Prim1=5]="Prim1",u[u.Prim1Annot=6]="Prim1Annot",u[u.Prim2=7]="Prim2",u[u.Prim2Annot=8]="Prim2Annot",u[u.Prim=9]="Prim",u[u.Bytes=10]="Bytes";class e1{constructor(){this.buffer=[]}get length(){return this.buffer.length}writeBytes(e){this.buffer.push(...e.map(e=>255&e))}writeUint8(e){this.buffer.push(255&(0|e))}writeUint16(e){let t=0|e;this.buffer.push(t>>8&255),this.buffer.push(255&t)}writeUint32(e){let t=0|e;this.buffer.push(t>>24&255),this.buffer.push(t>>16&255),this.buffer.push(t>>8&255),this.buffer.push(255&t)}writeInt8(e){this.writeUint8(e)}writeInt16(e){this.writeUint16(e)}writeInt32(e){this.writeUint32(e)}}let e2=Error("bounds out of range");class e5{constructor(e,t=0,r=e.length){this.buffer=e,this.idx=t,this.cap=r}get length(){return this.cap-this.idx}readBytes(e){if(this.cap-this.idx<e)throw e2;let t=this.buffer.slice(this.idx,this.idx+e);return this.idx+=e,t}reader(e){if(this.cap-this.idx<e)throw e2;let t=new e5(this.buffer,this.idx,this.idx+e);return this.idx+=e,t}copy(){return new e5(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw e2;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw e2;let e=this.buffer[this.idx++],t=this.buffer[this.idx++];return(e<<8|t)>>>0}readUint32(){if(this.cap-this.idx<4)throw e2;let e=this.buffer[this.idx++],t=this.buffer[this.idx++],r=this.buffer[this.idx++],i=this.buffer[this.idx++];return(e<<24|t<<16|r<<8|i)>>>0}readInt8(){if(this.cap-this.idx<1)throw e2;let e=this.buffer[this.idx++];return e<<24>>24}readInt16(){if(this.cap-this.idx<2)throw e2;let e=this.buffer[this.idx++],t=this.buffer[this.idx++];return(e<<8|t)<<16>>16}readInt32(){if(this.cap-this.idx<4)throw e2;let e=this.buffer[this.idx++],t=this.buffer[this.idx++],r=this.buffer[this.idx++],i=this.buffer[this.idx++];return e<<24|t<<16|r<<8|i}}function e3(e){let t;let r=e.readUint8();switch(r){case l.ED25519:t="ED25519PublicKeyHash";break;case l.SECP256K1:t="SECP256K1PublicKeyHash";break;case l.P256:t="P256PublicKeyHash";break;default:throw Error(`unknown public key hash tag: ${r}`)}return{type:t,hash:e.readBytes(20)}}function e6(e){let t;let r=e.readUint8();switch(r){case a.Implicit:t=e3(e);break;case a.Originated:t={type:"ContractHash",hash:e.readBytes(20)},e.readBytes(1);break;default:throw Error(`unknown address tag: ${r}`)}if(0!==e.length){let r=new TextDecoder;t.entryPoint=r.decode(new Uint8Array(e.readBytes(e.length)))}return t}function e8(e,t){let r;switch(e.type){case"ED25519PublicKeyHash":r=l.ED25519;break;case"SECP256K1PublicKeyHash":r=l.SECP256K1;break;case"P256PublicKeyHash":r=l.P256;break;default:throw Error(`unexpected address type: ${e.type}`)}t.writeUint8(r),t.writeBytes(Array.from(e.hash))}function e9(e){let t,r;let i=e.readUint8();switch(i){case o.ED25519:r="ED25519PublicKey",t=32;break;case o.SECP256K1:r="SECP256K1PublicKey",t=33;break;case o.P256:r="P256PublicKey",t=33;break;default:throw Error(`unknown public key tag: ${i}`)}return{type:r,publicKey:e.readBytes(t)}}(f=a||(a={}))[f.Implicit=0]="Implicit",f[f.Originated=1]="Originated",(g=l||(l={}))[g.ED25519=0]="ED25519",g[g.SECP256K1=1]="SECP256K1",g[g.P256=2]="P256",(m=o||(o={}))[m.ED25519=0]="ED25519",m[m.SECP256K1=1]="SECP256K1",m[m.P256=2]="P256";let e4=e=>"prim"in e&&("Left"===e.prim||"Right"===e.prim),e7=e=>"prim"in e&&("Some"===e.prim||"None"===e.prim),te=e=>{if(eA(e))return t=>{if(!ev(t))throw new eu(e,t,`pair expected: ${JSON.stringify(t)}`);e0(t);let r=eP("pair",e),i=eP("Pair",t);return[i,function*(){for(let e of r.args)yield te(e)}()]};switch(e.prim){case"or":return t=>{if(!e4(t))throw new eu(e,t,`or expected: ${JSON.stringify(t)}`);return[t,function*(){yield te(e.args["Left"===t.prim?0:1])}()]};case"option":return t=>{if(!e7(t))throw new eu(e,t,`option expected: ${JSON.stringify(t)}`);return[t,function*(){"Some"===t.prim&&(yield te(e.args[0]))}()]};case"list":case"set":return t=>{if(!Array.isArray(t))throw new eu(e,t,`${e.prim} expected: ${JSON.stringify(t)}`);return[t,function*(){for(let r of t)yield te(e.args[0])}()]};case"map":return t=>{if(!Array.isArray(t))throw new eu(e,t,`map expected: ${JSON.stringify(t)}`);return[t,function*(){for(let r of t)yield t=>{if(!("prim"in t)||"Elt"!==t.prim)throw new eu(e,t,`map element expected: ${JSON.stringify(t)}`);return[t,function*(){for(let t of e.args)yield te(t)}()]}}()]};case"chain_id":return t=>{let r;if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`chain id expected: ${JSON.stringify(t)}`);if("string"in t){let i=ey(t.string,"ChainID");if(null===i)throw new eu(e,t,`chain id base58 expected: ${t.string}`);r={bytes:e_(i[1])}}else r=t;return[r,[][Symbol.iterator]()]};case"signature":return t=>{let r;if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`signature expected: ${JSON.stringify(t)}`);if("string"in t){let i=ey(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(null===i)throw new eu(e,t,`signature base58 expected: ${t.string}`);r={bytes:e_(i[1])}}else r=t;return[r,[][Symbol.iterator]()]};case"key_hash":return t=>{let r;if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`key hash expected: ${JSON.stringify(t)}`);if("string"in t){let i=ey(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(null===i)throw new eu(e,t,`key hash base58 expected: ${t.string}`);let n=new e1;e8({type:i[0],hash:i[1]},n),r={bytes:e_(n.buffer)}}else r=t;return[r,[][Symbol.iterator]()]};case"key":return t=>{let r;if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`public key expected: ${JSON.stringify(t)}`);if("string"in t){let i=ey(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(null===i)throw new eu(e,t,`public key base58 expected: ${t.string}`);let n=new e1;!function(e,t){let r;switch(e.type){case"ED25519PublicKey":r=o.ED25519;break;case"SECP256K1PublicKey":r=o.SECP256K1;break;case"P256PublicKey":r=o.P256;break;default:throw Error(`unexpected public key type: ${e.type}`)}t.writeUint8(r),t.writeBytes(Array.from(e.publicKey))}({type:i[0],publicKey:i[1]},n),r={bytes:e_(n.buffer)}}else r=t;return[r,[][Symbol.iterator]()]};case"address":return t=>{let r;if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`address expected: ${JSON.stringify(t)}`);if("string"in t){let i=t.string.split("%"),n=ey(i[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(null===n)throw new eu(e,t,`address base58 expected: ${t.string}`);let s=new e1;!function(e,t){if("ContractHash"===e.type?(t.writeUint8(a.Originated),t.writeBytes(Array.from(e.hash)),t.writeUint8(0)):(t.writeUint8(a.Implicit),e8(e,t)),void 0!==e.entryPoint&&""!==e.entryPoint&&"default"!==e.entryPoint){let r=new TextEncoder,i=r.encode(e.entryPoint);t.writeBytes(Array.from(i))}}({type:n[0],hash:n[1],entryPoint:i.length>1?i[1]:void 0},s),r={bytes:e_(s.buffer)}}else r=t;return[r,[][Symbol.iterator]()]};case"timestamp":return t=>{let r;if(!("string"in t)&&!("int"in t))throw new eu(e,t,`timestamp expected: ${JSON.stringify(t)}`);if("string"in t){let i=eT(t);if(null===i)throw new eu(e,t,`can't parse date: ${t.string}`);r={int:String(Math.floor(i.getTime()/1e3))}}else r=t;return[r,[][Symbol.iterator]()]};default:return tr}},tt=e=>"prim"in e&&"PUSH"===e.prim,tr=e=>tt(e)?(eF(e),[e,function*(){yield tr,yield te(e.args[0])}()]):[e,function*(){for(;;)yield tr}()],ti=e=>{if(eA(e))return[t=>{if(!ev(t))throw new eu(e,t,`pair expected: ${JSON.stringify(t)}`);let r=eP("pair",e);return function*(){for(let e of r.args)yield ti(e)}()},e=>e];switch(e.prim){case"or":return[t=>{if(!e4(t))throw new eu(e,t,`or expected: ${JSON.stringify(t)}`);return function*(){yield ti(e.args["Left"===t.prim?0:1])}()},e=>e];case"option":return[t=>{if(!e7(t))throw new eu(e,t,`option expected: ${JSON.stringify(t)}`);return function*(){"Some"===t.prim&&(yield ti(e.args[0]))}()},e=>e];case"list":case"set":return[t=>{if(!Array.isArray(t))throw new eu(e,t,`${e.prim} expected: ${JSON.stringify(t)}`);return function*(){for(;;)yield ti(e.args[0])}()},e=>e];case"map":return[t=>{if(!Array.isArray(t))throw new eu(e,t,`map expected: ${JSON.stringify(t)}`);return function*(){for(;;)yield[t=>{if(!("prim"in t)||"Elt"!==t.prim)throw new eu(e,t,`map element expected: ${JSON.stringify(t)}`);return function*(){for(let t of e.args)yield ti(t)}()},e=>e]}()},e=>e];case"chain_id":return[()=>[][Symbol.iterator](),t=>{if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`chain id expected: ${JSON.stringify(t)}`);if("string"in t)return t;let r=eg(t.bytes);if(null===r)throw new eu(e,t,`can't parse bytes: ${t.bytes}`);return{string:eE("ChainID",r)}}];case"signature":return[()=>[][Symbol.iterator](),t=>{if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`signature expected: ${JSON.stringify(t)}`);if("string"in t)return t;let r=eg(t.bytes);if(null===r)throw new eu(e,t,`can't parse bytes: ${t.bytes}`);return{string:eE("GenericSignature",r)}}];case"key_hash":return[()=>[][Symbol.iterator](),t=>{if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`key hash expected: ${JSON.stringify(t)}`);if("string"in t)return t;let r=eg(t.bytes);if(null===r)throw new eu(e,t,`can't parse bytes: ${t.bytes}`);let i=new e5(new Uint8Array(r)),n=e3(i);return{string:eE(n.type,n.hash)+(n.entryPoint?"%"+n.entryPoint:"")}}];case"key":return[()=>[][Symbol.iterator](),t=>{if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`public key expected: ${JSON.stringify(t)}`);if("string"in t)return t;let r=eg(t.bytes);if(null===r)throw new eu(e,t,`can't parse bytes: ${t.bytes}`);let i=new e5(new Uint8Array(r)),n=e9(i);return{string:eE(n.type,n.publicKey)}}];case"address":return[()=>[][Symbol.iterator](),t=>{if(!("bytes"in t)&&!("string"in t))throw new eu(e,t,`address expected: ${JSON.stringify(t)}`);if("string"in t)return t;let r=eg(t.bytes);if(null===r)throw new eu(e,t,`can't parse bytes: ${t.bytes}`);let i=new e5(new Uint8Array(r)),n=e6(i);return{string:eE(n.type,n.hash)+(n.entryPoint?"%"+n.entryPoint:"")}}];case"timestamp":return[()=>[][Symbol.iterator](),t=>{if(!("int"in t)&&!("string"in t))throw new eu(e,t,`address expected: ${JSON.stringify(t)}`);if("string"in t)return t;let r=new Date(1e3*parseInt(t.int,10));return{string:r.toISOString().slice(0,19)+"Z"}}];default:return tn}},tn=[e=>tt(e)?(eF(e),function*(){yield tn,yield ti(e.args[0])}()):function*(){for(;;)yield tn}(),e=>e];class ts extends ec{constructor(e,t,r){super(e,r),this.stackState=t,Object.setPrototypeOf(this,ts.prototype)}}function ta(e){return Array.isArray(e)?"pair":e.prim}function tl(e){return"prim"in e?e.args:e}function to(e,t,r=!1){if(ta(e)!==ta(t))throw new eu(e,void 0,`types mismatch: ${ta(e)} != ${ta(t)}`);let i=[eb(e),eb(t)];if(i[0].t&&i[1].t&&i[0].t[0]!==i[1].t[0])throw new eu(e,void 0,`${ta(e)}: type names mismatch: ${i[0].t[0]} != ${i[1].t[0]}`);if(r&&i[0].f&&i[1].f&&i[0].f[0]!==i[1].f[0])throw new eu(e,void 0,`${ta(e)}: field names mismatch: ${i[0].f[0]} != ${i[1].f}`);if(eA(e)){let r=eP("pair",e),i=eP("pair",t);to(r.args[0],i.args[0],!0),to(r.args[1],i.args[1],!0);return}switch(e.prim){case"option":case"list":case"contract":case"set":case"ticket":to(e.args[0],t.args[0]);break;case"or":to(e.args[0],t.args[0],!0),to(e.args[1],t.args[1],!0);break;case"lambda":case"map":case"big_map":to(e.args[0],t.args[0]),to(e.args[1],t.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(e.args[0].int,10)!==parseInt(t.args[0].int,10))throw new eu(e,void 0,`${ta(e)}: type argument mismatch: ${e.args[0].int} != ${t.args[0].int}`)}}function tp(e,t){if(e.length!==t.length)throw new eu(e,void 0,`stack length mismatch: ${e.length} != ${t.length}`);for(let r=0;r<e.length;r++)to(e[r],t[r])}function tc(e,t=!1){var r,i,n;if(!Array.isArray(e)){let s=eb(e);if(((null===(r=s.t)||void 0===r?void 0:r.length)||0)>1)throw new eu(e,void 0,`${e.prim}: at most one type annotation allowed: ${e.annots}`);if(t){if(((null===(i=s.f)||void 0===i?void 0:i.length)||0)>1)throw new eu(e,void 0,`${e.prim}: at most one field annotation allowed: ${e.annots}`)}else if(((null===(n=s.f)||void 0===n?void 0:n.length)||0)>0)throw new eu(e,void 0,`${e.prim}: field annotations aren't allowed: ${e.annots}`)}if(eA(e)){let t=tl(e);for(let e of t)tc(e,!0);return}switch(e.prim){case"option":case"list":case"contract":case"set":tc(e.args[0]);break;case"or":for(let t of e.args)tc(t,!0);break;case"lambda":case"map":case"big_map":tc(e.args[0]),tc(e.args[1])}}function tu(e,t,r){if(eA(t)){if(ev(e)){e0(e);let i=eP("Pair",e),n=eP("pair",t);tu(i.args[0],n.args[0],r),tu(i.args[1],n.args[1],r);return}throw new eu(t,e,`pair expected: ${JSON.stringify(e)}`)}switch(t.prim){case"int":if("int"in e&&em(e.int))return;throw new eu(t,e,`integer value expected: ${JSON.stringify(e)}`);case"nat":case"mutez":if("int"in e&&eh(e.int))return;throw new eu(t,e,`natural value expected: ${JSON.stringify(e)}`);case"string":if("string"in e)return;throw new eu(t,e,`string value expected: ${JSON.stringify(e)}`);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in e&&null!==eg(e.bytes))return;throw new eu(t,e,`bytes value expected: ${JSON.stringify(e)}`);case"bool":if("prim"in e&&("True"===e.prim||"False"===e.prim))return;throw new eu(t,e,`boolean value expected: ${JSON.stringify(e)}`);case"key_hash":if("string"in e&&null!==ey(e.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash"))return;if("bytes"in e)try{!function(e){let t=eg(e.bytes);if(null===t)throw Error(`can't parse bytes: "${e.bytes}"`);let r=new e5(new Uint8Array(t));e3(r)}(e);return}catch(e){}throw new eu(t,e,`key hash expected: ${JSON.stringify(e)}`);case"timestamp":if(("string"in e||"int"in e)&&null!==eT(e))return;throw new eu(t,e,`timestamp expected: ${JSON.stringify(e)}`);case"address":if("string"in e){let t=e.string,r=e.string.indexOf("%");if(r>=0&&(t=e.string.slice(0,r)),null!==ey(t,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","TxRollupL2Address","RollupAddress"))return}else if("bytes"in e)try{!function(e){let t=eg(e.bytes);if(null===t)throw Error(`can't parse bytes: "${e.bytes}"`);let r=new e5(new Uint8Array(t));e6(r)}(e);return}catch(e){}throw new eu(t,e,`address expected: ${JSON.stringify(e)}`);case"key":if("string"in e&&null!==ey(e.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey"))return;if("bytes"in e)try{!function(e){let t=eg(e.bytes);if(null===t)throw Error(`can't parse bytes: "${e.bytes}"`);let r=new e5(new Uint8Array(t));e9(r)}(e);return}catch(e){}throw new eu(t,e,`public key expected: ${JSON.stringify(e)}`);case"unit":if("prim"in e&&"Unit"===e.prim)return;throw new eu(t,e,`unit value expected: ${JSON.stringify(e)}`);case"signature":if("bytes"in e||"string"in e&&null!==ey(e.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature"))return;throw new eu(t,e,`signature expected: ${JSON.stringify(e)}`);case"chain_id":if("bytes"in e||"string"in e){let t="string"in e?ei(e.string):eg(e.bytes);if(null!==t)return}throw new eu(t,e,`chain id expected: ${JSON.stringify(e)}`);case"option":if("prim"in e){if("None"===e.prim)return;if("Some"===e.prim){tu(e.args[0],t.args[0],r);return}}throw new eu(t,e,`option expected: ${JSON.stringify(e)}`);case"list":case"set":if(e0(e)){for(let i of e)tu(i,t.args[0],r);return}throw new eu(t,e,`${t.prim} expected: ${JSON.stringify(e)}`);case"or":if("prim"in e){if("Left"===e.prim){tu(e.args[0],t.args[0],r);return}if("Right"===e.prim){tu(e.args[0],t.args[1],r);return}}throw new eu(t,e,`union (or) expected: ${JSON.stringify(e)}`);case"lambda":if(function e(t){if(!Array.isArray(t))return!1;for(let r of t)if(!(Array.isArray(r)&&e(r)||"prim"in r&&eX(r)))return!1;return!0}(e)){let i=tf(e,[t.args[0]],r);if("failed"in i)throw new eu(t,e,`function is failed with error type: ${i.failed}`);if(1!==i.length)throw new eu(t,e,"function must return a value");to(t.args[1],i[0]);return}throw new eu(t,e,`function expected: ${JSON.stringify(e)}`);case"map":case"big_map":if(Array.isArray(e)){for(let i of e){if(!("prim"in i)||"Elt"!==i.prim)throw new eu(t,e,`map elements expected: ${JSON.stringify(e)}`);tu(i.args[0],t.args[0],r),tu(i.args[1],t.args[1],r)}return}throw new eu(t,e,`${t.prim} expected: ${JSON.stringify(e)}`);case"bls12_381_fr":if("int"in e&&em(e.int)||"bytes"in e&&null!==eg(e.bytes))return;throw new eu(t,e,`BLS12-381 element expected: ${JSON.stringify(e)}`);case"sapling_state":if(Array.isArray(e))return;throw new eu(t,e,`sapling state expected: ${JSON.stringify(e)}`);case"ticket":tu(e,{prim:"pair",args:[{prim:"address"},t.args[0],{prim:"nat"}]},r);return;default:throw new eu(t,e,`type ${ta(t)} don't have Michelson literal representation`)}}function tf(e,t,r){let i=(null==r?void 0:r.protocol)||S;if(Array.isArray(e))return function(e,t,r){let i=t,n=t,s=0;for(let t of e){let e=tf(t,n,r);if(i=e,"failed"in e)break;n=e,s++}if("failed"in i&&0==i.level&&(!("prim"in i.failed)||"never"!==i.failed.prim)&&s!==e.length-1)throw new ts(e,i,"FAIL must appear in a tail position");if((null==r?void 0:r.traceCallback)!==void 0){let n={op:e,in:t,out:i};r.traceCallback(n)}return"failed"in i?{failed:i.failed,level:i.level+1}:i}(e,t,r);function s(r,...i){if(t.length<i.length+r)throw new ts(e,t,`${e.prim}: stack must have at least ${i.length} element(s)`);let n=r;for(let r of i){if(null!==r&&0!==r.length){let i=0;for(;i<r.length&&r[i]!==ta(t[n]);)i++;if(i===r.length)throw new ts(e,t,`${e.prim}: stack type mismatch: [${n}] expected to be ${r}, got ${ta(t[n])} instead`)}n++}return t.slice(r,i.length+r)}function a(r){return(...i)=>{try{return r(...i)}catch(r){if(r instanceof ec)throw new ts(e,t,r.message);throw r}}}function l(r){return i=>{try{return r(i)}catch(r){if(r instanceof ec)throw new ts(e,t,r.message);throw r}}}let o=a(eb),p=a(tp),c=a(to),u=l(eH),f=l(eG),g=l(ej),m=l(eJ),h=l(eY);function d(r,i){let n=o(e,Object.assign(Object.assign({},i),{emptyFields:void 0!==r.f&&r.f>1,emptyVar:void 0!==r.v&&r.v>1})),s=(r,i,n)=>{if(r&&r.length>(i||0))throw new ts(e,t,`${e.prim}: at most ${i||0} ${n} annotations allowed`)};return s(n.f,r.f,"field"),s(n.t,r.t,"type"),s(n.v,r.v,"variable"),n}function b(e,t){let r=Array.isArray(e)?{prim:"pair",args:e}:e,i=o(r),n=void 0!==t.v||void 0!==t.t||void 0!==t.f?[...(null===t.v?i.v:t.v)||[],...(null===t.t?i.t:t.t)||[],...(null===t.f?i.f:t.f)||[]]:void 0,s=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r}(r,["annots"]);return Object.assign(Object.assign({},s),n&&0!==n.length&&{annots:n})}function w(e,t){let r=d({v:1});return b(e,{v:void 0!==r.v?r.v:void 0!==t?[t]:null,t:null})}function y(r,i,n,s,a){var l,p,c,u;let f=null===(l=o(i).f)||void 0===l?void 0:l[0],g=null===(p=n.f)||void 0===p?void 0:p[s];if(void 0!==g&&"%"!==g&&void 0!==f&&g!==f)throw new ts(e,t,`${e.prim}: field names doesn't match: ${g} !== ${f}`);let m=null===(c=n.v)||void 0===c?void 0:c[s],h=null===(u=o(r).v)||void 0===u?void 0:u[0];return b(i,{t:null,v:m?"@%"===m?f?["@"+f.slice(1)]:void 0:"@%%"===m?h?["@"+h.slice(1)+"."+(f?f.slice(1):a)]:f?["@"+f.slice(1)]:void 0:[m]:null})}let E=(e,t)=>["@"+(e.v?e.v[0].slice(1)+".":"")+t];function P(e,t){return"failed"in e||"failed"in t?"failed"in e?t:e:(p(e,t),e)}let A=(a=>{var l,A,S,T,I;switch(a.prim){case"DUP":{let e=a.args?parseInt(a.args[0].int,10):1;if(0===e)throw new ts(a,t,"DUP 0 is forbidden");let r=s(e-1,null)[0];if("ticket"===ta(r))throw new ts(a,t,"ticket can't be DUPed");return[r,...t]}case"SWAP":{let e=s(0,null,null);return d({}),[e[1],e[0],...t.slice(2)]}case"SOME":return[b({prim:"option",args:[s(0,null)[0]]},d({t:1,v:1})),...t.slice(1)];case"UNIT":return[b({prim:"unit"},d({v:1,t:1})),...t];case"PAIR":{let e=a.args?parseInt(a.args[0].int,10):2;if(e<2)throw new ts(a,t,`PAIR ${e} is forbidden`);let r=s(0,...Array(e).fill(null)),i=d({f:e,t:1,v:1},{specialFields:!0}),n=e=>{let t=e.lastIndexOf(".");return e.slice(t>0?t+1:1)},l=r.map((e,t)=>{var r;let s=o(e),a=i.f&&i.f.length>t&&"%"!==i.f[t]?"%@"===i.f[t]?s.v?["%"+n((null===(r=s.v)||void 0===r?void 0:r[0])||"")]:void 0:[i.f[t]]:void 0;return b(e,{v:null,t:null,f:a})});return[b({prim:"pair",args:l},{t:i.t,v:i.v}),...t.slice(e)]}case"UNPAIR":{let r=a.args?parseInt(a.args[0].int,10):2;if(r<2)throw new ts(a,t,`UNPAIR ${r} is forbidden`);let i=s(0,["pair"])[0],n=d({f:2,v:2},{specialVar:!0}),l=function r(i,n,s=n){let a=eP("pair",i);if(1===s)return[a.args[0]];if(2===s)return a.args;let l=a.args[1];if(eA(l))return[a.args[0],...r(l,n,s-1)];throw new ts(e,t,`${e.prim}: at least ${n} fields are expected`)}(i,r);return[...l.map((e,t)=>y(i,e,n,t,0===t?"car":"cdr")),...t.slice(1)]}case"CAR":case"CDR":{let e=eP("pair",s(0,["pair"])[0]),r=e.args["CAR"===a.prim?0:1],i=d({f:1,v:1},{specialVar:!0});return[y(e,r,i,0,a.prim.toLocaleLowerCase()),...t.slice(1)]}case"CONS":{let e=s(0,null,["list"]);return c(e[0],e[1].args[0]),[w({prim:"list",args:[e[1].args[0]]}),...t.slice(2)]}case"SIZE":return s(0,["string","list","set","map","bytes"]),[w({prim:"nat"}),...t.slice(1)];case"MEM":{let e=s(0,null,["set","map","big_map"]);return u(e[0]),c(e[0],e[1].args[0]),[w({prim:"bool"}),...t.slice(2)]}case"GET":if(a.args){let r=parseInt(a.args[0].int,10),i=s(0,["pair"])[0];return[w(function r(i,n,s=n){if(0===s)return i;let a=eP("pair",i);if(1===s)return a.args[0];let l=a.args[1];if(eA(l))return r(l,n,s-2);if(2===s)return l;throw new ts(e,t,`${e.prim}: at least ${n+1} fields are expected`)}(i,r)),...t.slice(1)]}{let e=s(0,null,["map","big_map"]);return u(e[0]),c(e[0],e[1].args[0]),[w({prim:"option",args:[e[1].args[1]]}),...t.slice(2)]}case"UPDATE":if(a.args){let r=parseInt(a.args[0].int,10),i=s(0,null,["pair"]);return[w(function r(i,n,s,a=s){if(0===a)return n;let l=eP("pair",i);if(1===a)return Object.assign(Object.assign({},l),{args:[n,l.args[1]]});let o=l.args[1];if(eA(o))return Object.assign(Object.assign({},l),{args:[l.args[0],r(o,n,s,a-2)]});if(2===a)return Object.assign(Object.assign({},l),{args:[l.args[0],n]});throw new ts(e,t,`${e.prim}: at least ${s+1} fields are expected`)}(i[1],i[0],r)),...t.slice(2)]}{let e=s(0,null,["bool","option"]);if(u(e[0]),"bool"===e[1].prim){let r=s(2,["set"]);return c(e[0],r[0].args[0]),[w({prim:"set",args:[b(e[0],{t:null})]}),...t.slice(3)]}let r=s(2,["map","big_map"]);if(c(e[0],r[0].args[0]),"map"===r[0].prim)return[w({prim:"map",args:[b(e[0],{t:null}),b(e[1].args[0],{t:null})]}),...t.slice(3)];return h(e[1].args[0]),[w({prim:"big_map",args:[b(e[0],{t:null}),b(e[1].args[0],{t:null})]}),...t.slice(3)]}case"GET_AND_UPDATE":{let e=d({v:2}),r=s(0,null,["option"],["map","big_map"]);u(r[0]),c(r[0],r[2].args[0]),c(r[1].args[0],r[2].args[1]);let i=null===(l=e.v)||void 0===l?void 0:l.map(e=>"@"!==e?[e]:void 0);if("map"===r[2].prim)return[b({prim:"option",args:[r[2].args[1]]},{v:null==i?void 0:i[0]}),b({prim:"map",args:[b(r[0],{t:null}),b(r[1].args[0],{t:null})]},{v:null==i?void 0:i[1]}),...t.slice(3)];return h(r[1].args[0]),[b({prim:"option",args:[r[2].args[1]]},{v:null==i?void 0:i[0]}),b({prim:"big_map",args:[b(r[0],{t:null}),b(r[1].args[0],{t:null})]},{v:null==i?void 0:i[1]}),...t.slice(3)]}case"EXEC":{let e=s(0,null,["lambda"]);return c(e[0],e[1].args[0]),[w(e[1].args[1]),...t.slice(2)]}case"APPLY":{let e=s(0,null,["lambda"]);if(g(e[0]),m(e[0]),!eA(e[1].args[0]))throw new ts(a,t,`${a.prim}: function's argument must be a pair: ${ta(e[1].args[0])}`);let r=e[1].args[0];return c(e[0],tl(r)[0]),[w({prim:"lambda",args:[tl(r)[1],e[1].args[1]]}),...t.slice(2)]}case"FAILWITH":{let e=s(0,null)[0];return _(i,n.PtEdo2Zk)||f(e),{failed:e,level:0}}case"NEVER":return s(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[w(s(0,null)[0]),...t.slice(1)];case"CONCAT":{let e=s(0,["string","list","bytes"]);if("list"===e[0].prim){if("string"!==ta(e[0].args[0])&&"bytes"!==ta(e[0].args[0]))throw new ts(a,t,`${a.prim}: can't concatenate list of ${ta(e[0].args[0])}'s`);return[w(e[0].args[0]),...t.slice(1)]}let r=s(1,["string","bytes"]);if(e[0].prim!==r[0].prim)throw new ts(a,t,`${a.prim}: can't concatenate ${e[0].prim} with ${r[0].prim}`);return[w(r[0]),...t.slice(2)]}case"SLICE":return[w({prim:"option",args:[s(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...t.slice(3)];case"PACK":{let e=s(0,null)[0];return f(e),[w({prim:"bytes"},"@packed"),...t.slice(1)]}case"ADD":{let e=s(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if("nat"===e[0].prim&&"int"===e[1].prim||"int"===e[0].prim&&"nat"===e[1].prim)return[w({prim:"int"}),...t.slice(2)];if("int"===e[0].prim&&"timestamp"===e[1].prim||"timestamp"===e[0].prim&&"int"===e[1].prim)return[w({prim:"timestamp"}),...t.slice(2)];if(("int"===e[0].prim||"nat"===e[0].prim||"mutez"===e[0].prim||"bls12_381_g1"===e[0].prim||"bls12_381_g2"===e[0].prim||"bls12_381_fr"===e[0].prim)&&e[0].prim===e[1].prim)return[w(e[0]),...t.slice(2)];throw new ts(a,t,`${a.prim}: can't add ${e[0].prim} to ${e[1].prim}`)}case"SUB":{let e=_(i,n.PsiThaCa)?s(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):s(0,["nat","int","timestamp"],["nat","int","timestamp"]);if(("nat"===e[0].prim||"int"===e[0].prim)&&("nat"===e[1].prim||"int"===e[1].prim)||"timestamp"===e[0].prim&&"timestamp"===e[1].prim)return[w({prim:"int"}),...t.slice(2)];if("timestamp"===e[0].prim&&"int"===e[1].prim)return[w({prim:"timestamp"}),...t.slice(2)];if("mutez"===e[0].prim&&"mutez"===e[1].prim)return[w({prim:"mutez"}),...t.slice(2)];throw new ts(a,t,`${a.prim}: can't subtract ${e[0].prim} from ${e[1].prim}`)}case"SUB_MUTEZ":return s(0,["mutez"],["mutez"]),[w({prim:"option",args:[{prim:"mutez"}]}),...t.slice(2)];case"MUL":{let e=s(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if("nat"===e[0].prim&&"int"===e[1].prim||"int"===e[0].prim&&"nat"===e[1].prim)return[w({prim:"int"}),...t.slice(2)];if("nat"===e[0].prim&&"mutez"===e[1].prim||"mutez"===e[0].prim&&"nat"===e[1].prim)return[w({prim:"mutez"}),...t.slice(2)];if(("bls12_381_g1"===e[0].prim||"bls12_381_g2"===e[0].prim||"bls12_381_fr"===e[0].prim)&&"bls12_381_fr"===e[1].prim||("nat"===e[0].prim||"int"===e[0].prim)&&e[0].prim===e[1].prim)return[w(e[0]),...t.slice(2)];if(("nat"===e[0].prim||"int"===e[0].prim)&&"bls12_381_fr"===e[1].prim||("nat"===e[1].prim||"int"===e[1].prim)&&"bls12_381_fr"===e[0].prim)return[w({prim:"bls12_381_fr"}),...t.slice(2)];throw new ts(a,t,`${a.prim}: can't multiply ${e[0].prim} by ${e[1].prim}`)}case"EDIV":{let e=(e,t)=>({prim:"option",args:[{prim:"pair",args:[{prim:e},{prim:t}]}]}),r=s(0,["nat","int","mutez"],["nat","int","mutez"]);if("nat"===r[0].prim&&"nat"===r[1].prim)return[w(e("nat","nat")),...t.slice(2)];if(("nat"===r[0].prim||"int"===r[0].prim)&&("nat"===r[1].prim||"int"===r[1].prim))return[w(e("int","nat")),...t.slice(2)];if("mutez"===r[0].prim&&"nat"===r[1].prim)return[w(e("mutez","mutez")),...t.slice(2)];if("mutez"===r[0].prim&&"mutez"===r[1].prim)return[w(e("nat","mutez")),...t.slice(2)];throw new ts(a,t,`${a.prim}: can't euclideally divide ${r[0].prim} by ${r[1].prim}`)}case"ABS":return s(0,["int"]),[w({prim:"nat"}),...t.slice(1)];case"ISNAT":return s(0,["int"]),[w({prim:"option",args:[{prim:"nat"}]}),...t.slice(1)];case"INT":return s(0,["nat","bls12_381_fr","bytes"]),[w({prim:"int"}),...t.slice(1)];case"BYTES":return s(0,["nat","int"]),[w({prim:"bytes"}),...t.slice(1)];case"NAT":return s(0,["bytes"]),[w({prim:"nat"}),...t.slice(1)];case"NEG":{let e=s(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];if("nat"===e.prim||"int"===e.prim)return[w({prim:"int"}),...t.slice(1)];return[w(e),...t.slice(1)]}case"LSL":case"LSR":return s(0,["nat","bytes"],["nat","bytes"]),[w({prim:"nat"}),...t.slice(2)];case"OR":case"XOR":{let e=s(0,["nat","bytes","bool"],["nat","bytes","bool"]);if(e[0].prim!==e[1].prim)throw new ts(a,t,`${a.prim}: both arguments must be of the same type: ${e[0].prim}, ${e[1].prim}`);return[w(e[1]),...t.slice(2)]}case"AND":{let e=s(0,["nat","bytes","bool","int"],["nat","bytes","bool"]);if(("int"!==e[0].prim||"nat"!==e[1].prim)&&e[0].prim!==e[1].prim)throw new ts(a,t,`${a.prim}: both arguments must be of the same type: ${e[0].prim}, ${e[1].prim}`);return[w(e[1]),...t.slice(2)]}case"NOT":{let e=s(0,["nat","bytes","bool","int"])[0];if("bool"===e.prim)return[w({prim:"bool"}),...t.slice(1)];return[w({prim:"int"}),...t.slice(1)]}case"COMPARE":{let e=s(0,null,null);return u(e[0]),u(e[1]),[w({prim:"int"}),...t.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return s(0,["int"]),[w({prim:"bool"}),...t.slice(1)];case"SELF":{if((null==r?void 0:r.contract)===void 0)throw new ts(a,t,`${a.prim}: contract required`);let e=d({f:1,v:1}),i=th(r.contract,null===(A=e.f)||void 0===A?void 0:A[0]);if(null===i)throw new ts(a,t,`${a.prim}: contract has no entrypoint ${i}`);return[b({prim:"contract",args:[i]},{v:e.v?e.v:["@self"]}),...t]}case"TRANSFER_TOKENS":{let e=s(0,null,["mutez"],["contract"]);return c(e[0],e[2].args[0]),[w({prim:"operation"}),...t.slice(3)]}case"SET_DELEGATE":{let e=s(0,["option"])[0];if("key_hash"!==ta(e.args[0]))throw new ts(a,t,`${a.prim}: key hash expected: ${ta(e.args[0])}`);return[w({prim:"operation"}),...t.slice(1)]}case"IMPLICIT_ACCOUNT":return s(0,["key_hash"]),[w({prim:"contract",args:[{prim:"unit"}]}),...t.slice(1)];case"NOW":return[w({prim:"timestamp"},"@now"),...t];case"AMOUNT":return[w({prim:"mutez"},"@amount"),...t];case"BALANCE":return[w({prim:"mutez"},"@balance"),...t];case"CHECK_SIGNATURE":return s(0,["key"],["signature"],["bytes"]),[w({prim:"bool"}),...t.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return s(0,["bytes"]),[w({prim:"bytes"}),...t.slice(1)];case"HASH_KEY":return s(0,["key"]),[w({prim:"key_hash"}),...t.slice(1)];case"SOURCE":return[w({prim:"address"},"@source"),...t];case"SENDER":return[w({prim:"address"},"@sender"),...t];case"ADDRESS":{let e=s(0,["contract"])[0],r=d({v:1});return[b({prim:"address",[v]:e},{v:r.v?r.v:E(o(e),"address")}),...t.slice(1)]}case"SELF_ADDRESS":{let e={prim:"address"};return(null==r?void 0:r.contract)!==void 0&&(e[v]={prim:"contract",args:[tg(r.contract,"parameter").args[0]]}),[w(e,"@address"),...t]}case"CHAIN_ID":return[w({prim:"chain_id"}),...t];case"DROP":{d({});let e=void 0!==a.args?parseInt(a.args[0].int,10):1;return s(e-1,null),t.slice(e)}case"DIG":{d({});let e=parseInt(a.args[0].int,10);return[s(e,null)[0],...t.slice(0,e),...t.slice(e+1)]}case"DUG":{d({});let e=parseInt(a.args[0].int,10);return[...t.slice(1,e+1),s(0,null)[0],...t.slice(e+1)]}case"NONE":return tc(a.args[0]),[b({prim:"option",args:[a.args[0]]},d({t:1,v:1})),...t];case"LEFT":case"RIGHT":{let e=s(0,null)[0],r=d({f:2,t:1,v:1},{specialFields:!0}),i=o(e),n=[b(e,{t:null,v:null,f:r.f&&r.f.length>0&&"%"!==r.f[0]?"%@"===r.f[0]?i.v?["%"+i.v[0].slice(1)]:void 0:r.f:void 0}),b(a.args[0],{t:null,f:r.f&&r.f.length>1&&"%"!==r.f[1]?r.f:void 0})];return[b({prim:"or",args:"LEFT"===a.prim?n:[n[1],n[0]]},{t:r.t,v:r.v}),...t.slice(1)]}case"NIL":return tc(a.args[0]),[b({prim:"list",args:[a.args[0]]},d({t:1,v:1})),...t];case"UNPACK":return s(0,["bytes"]),tc(a.args[0]),[w({prim:"option",args:[a.args[0]]},"@unpacked"),...t.slice(1)];case"CONTRACT":{let e=s(0,["address"])[0];tc(a.args[0]);let r=d({v:1,f:1}),i=e[v];if(void 0!==i){let e=th(i,null===(S=r.f)||void 0===S?void 0:S[0]);if(null===e)throw new ts(a,t,`${a.prim}: contract has no entrypoint ${e}`);c(e,a.args[0])}return[b({prim:"option",args:[{prim:"contract",args:[a.args[0]]}]},{v:r.v?r.v:E(o(e),"contract")}),...t.slice(1)]}case"CAST":{d({});let e=s(0,null)[0];return tc(a.args[0]),c(a.args[0],e),[a.args[0],...t.slice(1)]}case"IF_NONE":{d({});let e=s(0,["option"])[0],i=t.slice(1),n=tf(a.args[0],i,r),l=tf(a.args[1],[b(e.args[0],{t:null,v:E(o(e),"some")}),...i],r);return P(n,l)}case"IF_LEFT":{d({});let e=s(0,["or"])[0],i=o(e),n=o(e.args[0]),l=o(e.args[1]),p=t.slice(1),c=tf(a.args[0],[b(e.args[0],{t:null,v:E(i,n.f?n.f[0].slice(1):"left")}),...p],r),u=tf(a.args[1],[b(e.args[1],{t:null,v:E(i,l.f?l.f[0].slice(1):"right")}),...p],r);return P(c,u)}case"IF_CONS":{d({});let e=s(0,["list"])[0],i=o(e),n=t.slice(1),l=tf(a.args[0],[b(e.args[0],{t:null,v:E(i,"hd")}),b(e,{t:null,v:E(i,"tl")}),...n],r),p=tf(a.args[1],n,r);return P(l,p)}case"IF":{d({}),s(0,["bool"]);let e=t.slice(1),i=tf(a.args[0],e,r),n=tf(a.args[1],e,r);return P(i,n)}case"MAP":{let e=s(0,["list","map","option"])[0],i=t.slice(1),n="map"===e.prim?{prim:"pair",args:e.args}:e.args[0],l=tf(a.args[0],[b(n,{t:null,v:E(o(e),"elt")}),...i],r);if("failed"in l){if(!("prim"in l.failed)||"never"!==l.failed.prim)throw new ts(a,t,`${a.prim}: FAIL is not allowed in MAP`);return{failed:l.failed,level:l.level+1}}if(l.length<1)throw new ts(a,t,`${a.prim}: function must return a value`);return p(l.slice(1),i),"list"===e.prim?[w({prim:"list",args:[l[0]]}),...i]:"map"===e.prim?[w({prim:"map",args:[e.args[0],l[0]]}),...i]:[w({prim:"option",args:[l[0]]}),...i]}case"ITER":{d({});let e=s(0,["set","list","map"])[0],i=t.slice(1),n="map"===e.prim?{prim:"pair",args:e.args}:e.args[0],l=tf(a.args[0],[b(n,{t:null,v:E(o(e),"elt")}),...i],r);if("failed"in l)return{failed:l.failed,level:l.level+1};return p(l,i),i}case"LOOP":{d({}),s(0,["bool"]);let e=t.slice(1),i=tf(a.args[0],e,r);if("failed"in i)return{failed:i.failed,level:i.level+1};return p(i,[{prim:"bool"},...e]),e}case"LOOP_LEFT":{d({});let e=s(0,["or"])[0],i=t.slice(1),n=tf(a.args[0],[b(e.args[0],{t:null,v:E(o(e),"left")}),...i],r);if("failed"in n)return{failed:n.failed,level:n.level+1};return p(n,[e,...i]),[b(e.args[1],{t:null,v:d({v:1}).v}),...i]}case"DIP":{d({});let e=2===a.args.length?parseInt(a.args[0].int,10):1;s(e-1,null);let i=t.slice(0,e),n=t.slice(e),l=2===a.args.length?tf(a.args[1],n,r):tf(a.args[0],n,r);if("failed"in l)return{failed:l.failed,level:l.level+1};return[...i,...l]}case"CREATE_CONTRACT":{let e=d({v:2}),r=s(0,["option"],["mutez"],null);if("key_hash"!==ta(r[0].args[0]))throw new ts(a,t,`${a.prim}: key hash expected: ${ta(r[0].args[0])}`);g(r[2])&&(tb(a.args[0]),to(tg(a.args[0],"storage").args[0],r[2]));let i=null===(T=e.v)||void 0===T?void 0:T.map(e=>"@"!==e?[e]:void 0);return[b({prim:"operation"},{v:null==i?void 0:i[0]}),b({prim:"address",[v]:{prim:"contract",args:[tg(a.args[0],"parameter").args[0]]}},{v:null==i?void 0:i[1]}),...t.slice(3)]}case"PUSH":return tc(a.args[0]),tu(a.args[1],a.args[0],Object.assign(Object.assign({},r),{contract:void 0})),[w(a.args[0]),...t];case"EMPTY_SET":return tc(a.args[0]),u(a.args[0]),[b({prim:"set",args:a.args},d({t:1,v:1})),...t];case"EMPTY_MAP":return tc(a.args[0]),u(a.args[0]),tc(a.args[1]),[b({prim:"map",args:a.args},d({t:1,v:1})),...t];case"EMPTY_BIG_MAP":return tc(a.args[0]),u(a.args[0]),tc(a.args[1]),h(a.args[0]),[b({prim:"big_map",args:a.args},d({t:1,v:1})),...t];case"LAMBDA_REC":case"LAMBDA":{tc(a.args[0]),tc(a.args[1]);let e=[a.args[0]];"LAMBDA_REC"===a.prim&&e.push({prim:"lambda",args:[a.args[0],a.args[1]]});let i=tf(a.args[2],e,Object.assign(Object.assign({},r),{contract:void 0}));if("failed"in i)return{failed:i.failed,level:i.level+1};if(1!==i.length)throw new ts(a,t,`${a.prim}: function must return a value`);return c(a.args[1],i[0]),[w({prim:"lambda",args:[a.args[0],a.args[1]]}),...t]}case"LEVEL":return[w({prim:"nat"},"@level"),...t];case"TOTAL_VOTING_POWER":case"MIN_BLOCK_TIME":return[w({prim:"nat"}),...t];case"VOTING_POWER":return s(0,["key_hash"]),[w({prim:"nat"}),...t.slice(1)];case"TICKET":{let e=s(0,null,["nat"])[0];if(u(e),_(i,n.PtLimaPtL))return[b({prim:"ticket",args:[e]},d({t:1,v:1})),...t.slice(2)];return[w({prim:"option",args:[b({prim:"ticket",args:[e]},d({t:1,v:1}))]}),...t.slice(2)]}case"JOIN_TICKETS":{let e=eP("pair",s(0,["pair"])[0]);if("ticket"!==ta(e.args[0]))throw new ts(a,t,`${a.prim}: ticket expected: ${ta(e.args[0])}`);return c(e.args[0],e.args[1]),[w({prim:"option",args:[b(e.args[0],{t:null})]}),...t.slice(1)]}case"SPLIT_TICKET":{let e=s(0,["ticket"],["pair"]),r=eP("pair",e[1]);if("nat"!==ta(r.args[0]))throw new ts(a,t,`${a.prim}: nat expected: ${ta(r.args[0])}`);return c(r.args[0],r.args[1]),[w({prim:"option",args:[{prim:"pair",args:[b(e[0],{t:null}),b(e[0],{t:null})]}]}),...t.slice(2)]}case"READ_TICKET":{let e=d({v:2}),r=s(0,["ticket"])[0],i=null===(I=e.v)||void 0===I?void 0:I.map(e=>"@"!==e?[e]:void 0);return[b({prim:"pair",args:[{prim:"address"},b(r.args[0],{t:null}),{prim:"nat"}]},{v:null==i?void 0:i[0]}),b(r,{v:null==i?void 0:i[1],t:null}),...t.slice(1)]}case"PAIRING_CHECK":{let e=s(0,["list"])[0].args[0];if(!eA(e))throw new ts(a,t,`${a.prim}: pair expected: ${ta(e)}`);let r=eP("pair",e);if("bls12_381_g1"!==ta(r.args[0]))throw new ts(a,t,`${a.prim}: bls12_381_g1 expected: ${ta(r.args[0])}`);if("bls12_381_g2"!==ta(r.args[1]))throw new ts(a,t,`${a.prim}: bls12_381_g2 expected: ${ta(r.args[1])}`);return[w({prim:"bool"}),...t.slice(1)]}case"SAPLING_EMPTY_STATE":return[b({prim:"sapling_state",args:[a.args[0]]},d({v:1,t:1})),...t];case"SAPLING_VERIFY_UPDATE":{let e=s(0,["sapling_transaction"],["sapling_state"]);if(parseInt(e[0].args[0].int,10)!==parseInt(e[1].args[0].int,10))throw new ts(a,t,`${a.prim}: sapling memo size mismatch: ${e[0].args[0].int} != ${e[1].args[0].int}`);return _(i,n.PtJakarta)?[w({prim:"option",args:[{prim:"pair",args:[{prim:"int"},b(e[1],{t:null})]}]}),...t.slice(2)]:[w({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},b(e[1],{t:null})]}]}]}),...t.slice(2)]}case"OPEN_CHEST":return s(0,["chest_key"],["chest"],["nat"]),[w({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...t.slice(3)];case"VIEW":{let e=s(0,null,["address"]);return m(e[0]),[w({prim:"option",args:[a.args[1]]}),...t.slice(2)]}case"EMIT":{let e=d({f:1,t:1});if(a.args){let e=s(0,null);c(e[0],a.args[0])}return[b({prim:"operation"},e),...t.slice(1)]}default:throw new ec(a,`unexpected instruction: ${a.prim}`)}})(e);return(null==r?void 0:r.traceCallback)!==void 0&&r.traceCallback({op:e,in:t,out:A}),A}function tg(e,t){for(let r of e)if(r.prim===t)return r;throw new ec(e,`missing contract section: ${t}`)}function tm(e){if(Array.isArray(e)){for(let t of e)if("prim"in t&&("parameter"===t.prim||"storage"===t.prim||"code"===t.prim))return!0}return!1}function th(e,t){t=t||"%default";let r=td(e).find(e=>e[0]===t);return void 0!==r?r[1]:"%default"===t?tm(e)?tg(e,"parameter").args[0]:e:null}function td(e){if(tm(e)){let t=tg(e,"parameter"),r=td(t.args[0]),i=eb(t);return i.f?[[i.f[0],t.args[0]],...r]:r}if(Array.isArray(e)||"or"===e.prim){let t=tl(e),r=e=>{let r=eb(t[e]);if("or"===ta(t[e])){let i=td(t[e]);return r.f?[[r.f[0],t[e]],...i]:i}return r.f?[[r.f[0],t[e]]]:[]};return[...r(0),...r(1)]}return[]}function tb(e,t){let r=(r,i,n,s)=>{tc(r,!0),tc(i);let a={prim:"pair",args:[Object.assign(Object.assign({},r),{annots:["@parameter"]}),Object.assign(Object.assign({},i),{annots:["@storage"]})]},l=tf(s,[a],Object.assign(Object.assign({},t),{contract:e}));if("failed"in l)return l;try{tp(l,[n])}catch(e){if(e instanceof ec)throw new ts(s,l,e.message);throw e}return l},i=tg(e,"parameter").args[0],n=tg(e,"storage").args[0],s=tg(e,"code").args[0],a=r(i,n,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},n]},s);for(let t of Object.values(function(e){let t={};for(let r of e)"view"===r.prim&&(t[r.args[0].string]=r);return t}(e)))r(t.args[1],n,t.args[2],t.args[3]);return a}function tw(e,t,r){tc(t),tu(e,t,r||null)}class ty{constructor(e,t){this.contract=e,this.ctx=Object.assign({contract:e},t),this.output=tb(e,this.ctx)}static parse(e,t){let r=new W(t),i="string"==typeof e?r.parseScript(e):r.parseJSON(e);if(null===i)throw new en("empty contract");if(eZ(i))return new ty(i,t)}static parseTypeExpression(e,t){let r=new W(t),i="string"==typeof e?r.parseScript(e):r.parseJSON(e);if(null===i)throw new es("empty type expression");if(eV(i))return tc(i),i}static parseDataExpression(e,t){let r=new W(t),i="string"==typeof e?r.parseScript(e):r.parseJSON(e);if(null===i)throw new ea("empty data expression");if(eQ(i))return i;throw void 0}section(e){return tg(this.contract,e)}entryPoints(){return td(this.contract)}entryPoint(e){return th(this.contract,e)}assertDataValid(e,t){tw(e,t,this.ctx)}isDataValid(e,t){return function(e,t,r){try{return tw(e,t,r),!0}catch(e){return!1}}(e,t,this.ctx)}assertParameterValid(e,t){let r=this.entryPoint(e||void 0);if(null===r)throw new el(null==e?void 0:e.toString());this.assertDataValid(t,r)}isParameterValid(e,t){try{return this.assertParameterValid(e,t),!0}catch(e){return!1}}functionType(e,t){return function(e,t,r){for(let e of t)tc(e);if((null==r?void 0:r.contract)!==void 0)for(let e of["parameter","storage"]){let t=tg(r.contract,e).args[0];tc(t)}return tf(e,t,r||null)}(e,t,this.ctx)}}new ty([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}])}}]);